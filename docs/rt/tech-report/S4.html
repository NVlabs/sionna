<!DOCTYPE html>

<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>4 Radio Map Solver â€£ Sionna RT: Technical Report</title>
<!--Generated on Tue Jun  3 13:07:48 2025 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<link href="LaTeXML.css" rel="stylesheet" type="text/css"/>
<link href="ltx-article.css" rel="stylesheet" type="text/css"/>
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="style.css" rel="stylesheet" type="text/css"/>
<link href="./" rel="up" title="Sionna RT: Technical Report"/>
<link href="./" rel="start" title="Sionna RT: Technical Report"/>
</head>
<body><div class="nav-panel"><div class="nav-panel-header"><h1 class="nav-panel-header-title">NVIDIA Sionna RT</h1><p class="nav-panel-header-subtitle">Technical Report</p></div><div class="nav-panel-content"><nav class="ltx_TOC"><h2 class="nav-panel-toc-title">Contents</h2><ul class="ltx_toclist"><li class="ltx_tocentry"><a class="ltx_tocentry" href="S1.html">Introduction</a></li><li class="ltx_tocentry"><a class="ltx_tocentry" href="S2.html">Essential Concepts and Terminology</a><ul class="ltx_toclist ltx_toclist_subsections"><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="S2.html#SS1">Scene Objects and Meshes</a></li><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="S2.html#SS2">Rays and Paths</a></li><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="S2.html#SS3">Interactions with Scene Objects</a></li><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="S2.html#SS4">Ray Tubes</a></li></ul></li><li class="ltx_tocentry"><a class="ltx_tocentry" href="S3.html">Path Solver</a><ul class="ltx_toclist ltx_toclist_subsections"><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="S3.html#SS1">Generating Candidates by Shooting and Bouncing of Rays (SBR)</a></li><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="S3.html#SS2">Image Method-based Candidate Processing</a></li><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="S3.html#SS3">Channel Coefficients, Delays, and Doppler Shifts Computation</a></li></ul></li><li class="ltx_tocentry"><a class="ltx_tocentry" href="S4.html">Radio Map Solver</a><ul class="ltx_toclist ltx_toclist_subsections"><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="S4.html#SS1">Definition of a Radio Map</a></li><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="S4.html#SS2">SBR-based Radio Map Solver</a></li></ul></li><li class="ltx_tocentry"><a class="ltx_tocentry" href="A1.html">Appendix: Primer on Electromagnetism</a><ul class="ltx_toclist ltx_toclist_subsections"><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="A1.html#SS1">Coordinate System, Rotations, and Vector Fields</a></li><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="A1.html#SS2">Planar Time-Harmonic Waves</a></li><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="A1.html#SS3">Far Field of a Transmitting Antenna</a></li><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="A1.html#SS4">Modeling of a Receiving Antenna</a></li><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="A1.html#SS5">General Propagation Path</a></li><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="A1.html#SS6">Frequency and Impulse Response</a></li><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="A1.html#SS7">Specular Reflection and Refraction</a></li><li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_tocentry ltx_tocentry_subsection" href="A1.html#SS8">Diffuse Reflection</a></li></ul></li><li class="ltx_tocentry"><a class="ltx_tocentry" href="bib.html">References</a></li></ul></nav></div></div>
<div class="ltx_page_main">
<header class="ltx_page_header">
<div class="ltx_align_left"><a href="S3.html">â† Previous</a></div><div class="ltx_align_right"><a href="A1.html">Next â†’</a></div><div class="ltx_align_center"><a href="index.html">Sionna RT: Technical Report</a></div></header>
<div class="ltx_page_content">
<section class="ltx_section ltx_authors_1line" lang="en">
<h1 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Radio Map Solver</h1>
<div class="ltx_para" id="p1">
<p class="ltx_p">In the previous sections, we have detailed the path solver, which computes propagation paths and the related electric fields from a source to a target. Now, we turn our attention to the radio map solver, which computes a <em class="ltx_emph ltx_font_italic">radio map</em> (also known as <em class="ltx_emph ltx_font_italic">coverage map</em> or <em class="ltx_emph ltx_font_italic">power map</em>) for a given scene and source. While we describe the algorithm for a single source, SionnaÂ RT can compute radio maps for multiple sources in parallel.</p>
</div>
<figure class="ltx_figure" id="F22">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="F22.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="396" id="F22.sf1.g1" src="x24.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" style="font-size:90%;">(a)</span> </span><span class="ltx_text" style="font-size:90%;">Scene with a measurement plane.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="F22.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="399" id="F22.sf2.g1" src="x25.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" style="font-size:90%;">(b)</span> </span><span class="ltx_text" style="font-size:90%;">Radio map for the measurement plane in (a).</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" style="font-size:90%;">Figure 22</span>: </span><span class="ltx_text" style="font-size:90%;">(a) A measurement plane is placed in the scene to capture paths without affecting their propagation, (b) the resulting radio map showing the spatial distribution of channel gains.</span></figcaption>
</figure>
<div class="ltx_para" id="p2">
<p class="ltx_p">A radio map estimates the channel gainÂ (<a class="ltx_ref" href="S1.html#E5" title="In 1 Introduction â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">5</span></a>) from a source to each point on a <em class="ltx_emph ltx_font_italic">measurement plane</em>, as illustrated in FigureÂ <a class="ltx_ref" href="#F22" title="Figure 22 â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">22</span></a>. The measurement plane is partitioned into <em class="ltx_emph ltx_font_italic">measurement cells</em> of identical size. For each cell, the solver estimates the average channel gain that would be observed by a target placed within that cell.
Note that the measurement plane does not interact with the electromagnetic waves, but only serves to capture the paths that intersect it.</p>
</div>
<div class="ltx_para" id="p3">
<p class="ltx_p">In SectionÂ <a class="ltx_ref" href="#SS1" title="4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">4.1</span></a>, we present a definition of radio maps that allows for their efficient computation using Monte Carlo integration. This approach, detailed in SectionÂ <a class="ltx_ref" href="#SS2" title="4.2 SBR-based Radio Map Solver â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">4.2</span></a>, makes the computation of radio maps both fast and scalable.</p>
</div>
<section class="ltx_subsection" id="SS1">
<h2 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>Definition of a Radio Map</h2>
<div class="ltx_para" id="SS1.p1">
<p class="ltx_p">Consider a point source <math alttext="\mathbf{s}" class="ltx_Math" display="inline" id="SS1.p1.m1"><mi>ğ¬</mi></math>. The measurement plane, denoted as <math alttext="{\cal M}" class="ltx_Math" display="inline" id="SS1.p1.m2"><mi class="ltx_font_mathcaligraphic">â„³</mi></math>, is partitioned into <math alttext="N_{M}" class="ltx_Math" display="inline" id="SS1.p1.m3"><msub><mi>N</mi><mi>M</mi></msub></math> cells, each with an equal area <math alttext="\left|C\right|" class="ltx_Math" display="inline" id="SS1.p1.m4"><mrow><mo>|</mo><mi>C</mi><mo>|</mo></mrow></math>. The radio map value for the <math alttext="i" class="ltx_Math" display="inline" id="SS1.p1.m5"><mi>i</mi></math>-th cell, where <math alttext="i\in\left\{1,\dots,N_{M}\right\}" class="ltx_Math" display="inline" id="SS1.p1.m6"><mrow><mi>i</mi><mo>âˆˆ</mo><mrow><mo>{</mo><mn>1</mn><mo>,</mo><mi mathvariant="normal">â€¦</mi><mo>,</mo><msub><mi>N</mi><mi>M</mi></msub><mo>}</mo></mrow></mrow></math>, is defined as:</p>
<table class="ltx_equation ltx_eqn_table" id="E33">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="C_{i}=\frac{1}{\left|C\right|}\int_{C_{i}}\bar{e}\left(\mathbf{t}\right)d%
\mathbf{t}." class="ltx_Math" display="block" id="E33.m1"><mrow><mrow><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><mrow><mfrac><mn>1</mn><mrow><mo>|</mo><mi>C</mi><mo>|</mo></mrow></mfrac><mo>â¢</mo><mrow><msub><mo>âˆ«</mo><msub><mi>C</mi><mi>i</mi></msub></msub><mrow><mover accent="true"><mi>e</mi><mo>Â¯</mo></mover><mo>â¢</mo><mrow><mo>(</mo><mi>ğ­</mi><mo>)</mo></mrow><mo lspace="0em">â¢</mo><mrow><mo rspace="0em">ğ‘‘</mo><mi>ğ­</mi></mrow></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(33)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Here, <math alttext="\bar{e}\left(\mathbf{t}\right)" class="ltx_Math" display="inline" id="SS1.p1.m7"><mrow><mover accent="true"><mi>e</mi><mo>Â¯</mo></mover><mo>â¢</mo><mrow><mo>(</mo><mi>ğ­</mi><mo>)</mo></mrow></mrow></math> denotes the channel gain at the position <math alttext="\mathbf{t}" class="ltx_Math" display="inline" id="SS1.p1.m8"><mi>ğ­</mi></math> on the measurement plane, considering all paths originating from the source <math alttext="\mathbf{s}" class="ltx_Math" display="inline" id="SS1.p1.m9"><mi>ğ¬</mi></math>. Assuming a discrete set of paths impacts the measurement plane at <math alttext="\mathbf{t}" class="ltx_Math" display="inline" id="SS1.p1.m10"><mi>ğ­</mi></math>, <math alttext="\bar{e}\left(\mathbf{t}\right)" class="ltx_Math" display="inline" id="SS1.p1.m11"><mrow><mover accent="true"><mi>e</mi><mo>Â¯</mo></mover><mo>â¢</mo><mrow><mo>(</mo><mi>ğ­</mi><mo>)</mo></mrow></mrow></math> can be expressed as</p>
<table class="ltx_equation ltx_eqn_table" id="E34">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\bar{e}\left(\mathbf{t}\right)=\sum_{\ell=0}^{\infty}\sum_{p\in{\cal P}\left(%
\mathbf{s},\ell,\mathbf{t}\right)}e(p)" class="ltx_Math" display="block" id="E34.m1"><mrow><mrow><mover accent="true"><mi>e</mi><mo>Â¯</mo></mover><mo>â¢</mo><mrow><mo>(</mo><mi>ğ­</mi><mo>)</mo></mrow></mrow><mo rspace="0.111em">=</mo><mrow><munderover><mo movablelimits="false" rspace="0em">âˆ‘</mo><mrow><mi mathvariant="normal">â„“</mi><mo>=</mo><mn>0</mn></mrow><mi mathvariant="normal">âˆ</mi></munderover><mrow><munder><mo movablelimits="false">âˆ‘</mo><mrow><mi>p</mi><mo>âˆˆ</mo><mrow><mi class="ltx_font_mathcaligraphic">ğ’«</mi><mo>â¢</mo><mrow><mo>(</mo><mi>ğ¬</mi><mo>,</mo><mi mathvariant="normal">â„“</mi><mo>,</mo><mi>ğ­</mi><mo>)</mo></mrow></mrow></mrow></munder><mrow><mi>e</mi><mo>â¢</mo><mrow><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(34)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where <math alttext="{\cal P}\left(\mathbf{s},\ell,\mathbf{t}\right)" class="ltx_Math" display="inline" id="SS1.p1.m12"><mrow><mi class="ltx_font_mathcaligraphic">ğ’«</mi><mo>â¢</mo><mrow><mo>(</mo><mi>ğ¬</mi><mo>,</mo><mi mathvariant="normal">â„“</mi><mo>,</mo><mi>ğ­</mi><mo>)</mo></mrow></mrow></math> represents the set of all paths with depth <math alttext="\ell" class="ltx_Math" display="inline" id="SS1.p1.m13"><mi mathvariant="normal">â„“</mi></math> that originate from <math alttext="\mathbf{s}" class="ltx_Math" display="inline" id="SS1.p1.m14"><mi>ğ¬</mi></math> and intersect the measurement plane at <math alttext="\mathbf{t}" class="ltx_Math" display="inline" id="SS1.p1.m15"><mi>ğ­</mi></math>. The term <math alttext="e(p)" class="ltx_Math" display="inline" id="SS1.p1.m16"><mrow><mi>e</mi><mo>â¢</mo><mrow><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo></mrow></mrow></math> is defined as:</p>
<table class="ltx_equation ltx_eqn_table" id="E35">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="e(p)=\left\lVert\frac{\lambda}{4\pi}\left(\prod_{\ell^{\prime}=1}^{\ell}%
\mathbf{T}^{(\ell^{\prime})}\right)\mathbf{C}_{\text{T}}(\theta_{\text{T}},%
\varphi_{\text{T}})\right\rVert^{2}_{2}." class="ltx_Math" display="block" id="E35.m1"><mrow><mrow><mrow><mi>e</mi><mo>â¢</mo><mrow><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo></mrow></mrow><mo rspace="0.1389em">=</mo><msubsup><mrow><mo fence="true" lspace="0.1389em" rspace="0em" stretchy="true">âˆ¥</mo><mrow><mfrac><mi>Î»</mi><mrow><mn>4</mn><mo>â¢</mo><mi>Ï€</mi></mrow></mfrac><mo>â¢</mo><mrow><mo>(</mo><mrow><munderover><mo lspace="0em" movablelimits="false">âˆ</mo><mrow><msup><mi mathvariant="normal">â„“</mi><mo>â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi mathvariant="normal">â„“</mi></munderover><msup><mi>ğ“</mi><mrow><mo stretchy="false">(</mo><msup><mi mathvariant="normal">â„“</mi><mo>â€²</mo></msup><mo stretchy="false">)</mo></mrow></msup></mrow><mo>)</mo></mrow><mo>â¢</mo><msub><mi>ğ‚</mi><mtext>T</mtext></msub><mo>â¢</mo><mrow><mo stretchy="false">(</mo><msub><mi>Î¸</mi><mtext>T</mtext></msub><mo>,</mo><msub><mi>Ï†</mi><mtext>T</mtext></msub><mo stretchy="false">)</mo></mrow></mrow><mo fence="true" lspace="0em" rspace="0em" stretchy="true">âˆ¥</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><mo lspace="0em">.</mo></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(35)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">In this context, <math alttext="\lambda" class="ltx_Math" display="inline" id="SS1.p1.m17"><mi>Î»</mi></math> is the wavelength, <math alttext="\ell" class="ltx_Math" display="inline" id="SS1.p1.m18"><mi mathvariant="normal">â„“</mi></math> is the number of scatterers along the path <math alttext="p" class="ltx_Math" display="inline" id="SS1.p1.m19"><mi>p</mi></math>, <math alttext="\mathbf{C}_{\text{T}}" class="ltx_Math" display="inline" id="SS1.p1.m20"><msub><mi>ğ‚</mi><mtext>T</mtext></msub></math> is a complex-valued vector of dimension 2 representing the transmit antenna pattern evaluated at the angles of departure of <math alttext="p" class="ltx_Math" display="inline" id="SS1.p1.m21"><mi>p</mi></math>, <math alttext="(\theta_{\text{T}},\varphi_{\text{T}})" class="ltx_Math" display="inline" id="SS1.p1.m22"><mrow><mo stretchy="false">(</mo><msub><mi>Î¸</mi><mtext>T</mtext></msub><mo>,</mo><msub><mi>Ï†</mi><mtext>T</mtext></msub><mo stretchy="false">)</mo></mrow></math>, and <math alttext="\mathbf{T}^{(\ell^{\prime})}" class="ltx_Math" display="inline" id="SS1.p1.m23"><msup><mi>ğ“</mi><mrow><mo stretchy="false">(</mo><msup><mi mathvariant="normal">â„“</mi><mo>â€²</mo></msup><mo stretchy="false">)</mo></mrow></msup></math> is a <math alttext="2\times 2" class="ltx_Math" display="inline" id="SS1.p1.m24"><mrow><mn>2</mn><mo lspace="0.222em" rspace="0.222em">Ã—</mo><mn>2</mn></mrow></math> complex-valued matrix modeling the interaction with the <math alttext="\ell^{\prime}" class="ltx_Math" display="inline" id="SS1.p1.m25"><msup><mi mathvariant="normal">â„“</mi><mo>â€²</mo></msup></math>-th scatterer. Unlike inÂ (<a class="ltx_ref" href="S1.html#E4" title="In 1 Introduction â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">4</span></a>), the receive antenna pattern is not applied here.
Instead, the squared norm of the electric field is used. This is equivalent to assuming that a receiver positioned on the measurement plane uses a dual-polarized isotropic antenna, and that both components are combined non-coherently.</p>
</div>
<div class="ltx_para" id="SS1.p2">
<p class="ltx_p">While the definitionÂ (<a class="ltx_ref" href="#E33" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">33</span></a>) is comprehensive, it is not directly practical for computation. A straightforward but inefficient method to compute a radio map is to calculate the paths for each measurement cell using the path solver (SectionÂ <a class="ltx_ref" href="S3.html" title="3 Path Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">3</span></a>) by placing one or more targets within each cell. However, this approach becomes computationally prohibitive as the number of cells increases. Therefore, we reformulate the radio map definitionÂ (<a class="ltx_ref" href="#E33" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">33</span></a>) to enable efficient computation via Monte Carlo integration.</p>
</div>
<figure class="ltx_figure" id="F23"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="279" id="F23.g1" src="x26.png" width="664"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" style="font-size:90%;">Figure 23</span>: </span><span class="ltx_text" style="font-size:90%;">Three specular chains, each indexed by a subscript. The sequence of interaction types and the departure direction uniquely determine the directions of the scattered rays, and therefore the paths. Shown in 2D for clarity.</span></figcaption>
</figure>
<div class="ltx_para" id="SS1.p3">
<p class="ltx_p">To build intuition, letâ€™s first consider the scenario where all paths from the source <math alttext="\mathbf{s}" class="ltx_Math" display="inline" id="SS1.p3.m1"><mi>ğ¬</mi></math> to the measurement cells are specular chains, meaning they contain no diffuse reflections. In this case, for a given scene and source <math alttext="\mathbf{s}" class="ltx_Math" display="inline" id="SS1.p3.m2"><mi>ğ¬</mi></math>, a path of depth <math alttext="\ell" class="ltx_Math" display="inline" id="SS1.p3.m3"><mi mathvariant="normal">â„“</mi></math> is fully characterized by its sequence of interaction types <math alttext="\boldsymbol{\chi}^{(\ell)}=\left(\chi^{(1)},\cdots,\chi^{(\ell)}\right)" class="ltx_Math" display="inline" id="SS1.p3.m4"><mrow><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mrow><mo>(</mo><msup><mi>Ï‡</mi><mrow><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><mi mathvariant="normal">â‹¯</mi><mo>,</mo><msup><mi>Ï‡</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>)</mo></mrow></mrow></math> and its departure direction <math alttext="\widehat{\mathbf{k}}^{(0)}" class="ltx_Math" display="inline" id="SS1.p3.m5"><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup></math>. This is because, in specular chains, the direction of the scattered wave at each interaction point is uniquely determined by the interaction type and the direction of incidence, as illustrated in FigureÂ <a class="ltx_ref" href="#F23" title="Figure 23 â€£ 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">23</span></a>. In this case, the definitionÂ (<a class="ltx_ref" href="#E33" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">33</span></a>) can be reformulated over the unit sphere <math alttext="\Omega" class="ltx_Math" display="inline" id="SS1.p3.m6"><mi mathvariant="normal">Î©</mi></math> centered on <math alttext="\mathbf{s}" class="ltx_Math" display="inline" id="SS1.p3.m7"><mi>ğ¬</mi></math>, which represents all possible ray departure directions.
To achieve this, we define <math alttext="p\left(\mathbf{s},\widehat{\mathbf{k}}^{(0)},\boldsymbol{\chi}^{(\ell)},%
\mathbf{t}\right)" class="ltx_Math" display="inline" id="SS1.p3.m8"><mrow><mi>p</mi><mo>â¢</mo><mrow><mo>(</mo><mi>ğ¬</mi><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><mi>ğ­</mi><mo>)</mo></mrow></mrow></math> as the path of depth <math alttext="\ell" class="ltx_Math" display="inline" id="SS1.p3.m9"><mi mathvariant="normal">â„“</mi></math> from <math alttext="\mathbf{s}" class="ltx_Math" display="inline" id="SS1.p3.m10"><mi>ğ¬</mi></math> to <math alttext="\mathbf{t}\in{\cal M}" class="ltx_Math" display="inline" id="SS1.p3.m11"><mrow><mi>ğ­</mi><mo>âˆˆ</mo><mi class="ltx_font_mathcaligraphic">â„³</mi></mrow></math>, characterized by the departure direction <math alttext="\widehat{\mathbf{k}}^{(0)}" class="ltx_Math" display="inline" id="SS1.p3.m12"><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup></math> and the sequence of interaction types <math alttext="\boldsymbol{\chi}^{(\ell)}" class="ltx_Math" display="inline" id="SS1.p3.m13"><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup></math>. The length of the corresponding ray tube is denoted by <math alttext="r" class="ltx_Math" display="inline" id="SS1.p3.m14"><mi>r</mi></math>, and the angle between the plane normal and the pathâ€™s incident direction is denoted by <math alttext="\theta" class="ltx_Math" display="inline" id="SS1.p3.m15"><mi>Î¸</mi></math>. By applying the change of variables <math alttext="d\mathbf{t}=\frac{r^{2}}{\cos\theta}d\widehat{\mathbf{k}}^{(0)}" class="ltx_Math" display="inline" id="SS1.p3.m16"><mrow><mrow><mi>d</mi><mo>â¢</mo><mi>ğ­</mi></mrow><mo>=</mo><mrow><mfrac><msup><mi>r</mi><mn>2</mn></msup><mrow><mi>cos</mi><mo lspace="0.167em">â¡</mo><mi>Î¸</mi></mrow></mfrac><mo>â¢</mo><mi>d</mi><mo>â¢</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup></mrow></mrow></math>, we can reformulate the definitionÂ (<a class="ltx_ref" href="#E33" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">33</span></a>) as:</p>
<table class="ltx_equation ltx_eqn_table" id="E36">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="C_{i}=\frac{1}{\left|C\right|}\sum_{\ell=0}^{\infty}\sum_{\boldsymbol{\chi}^{(%
\ell)}\in\left\{{\cal R},{\cal T}\right\}^{\ell}}\int_{\Omega}e\left(p\left(%
\mathbf{s},\widehat{\mathbf{k}}^{(0)},\boldsymbol{\chi}^{(\ell)},\mathbf{t}%
\right)\right)\mathbb{I}\left(\mathbf{t}\in C_{i}\right)\frac{r^{2}}{\cos%
\theta}d\widehat{\mathbf{k}}^{(0)}." class="ltx_Math" display="block" id="E36.m1"><mrow><mrow><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><mrow><mfrac><mn>1</mn><mrow><mo>|</mo><mi>C</mi><mo>|</mo></mrow></mfrac><mo>â¢</mo><mrow><munderover><mo movablelimits="false" rspace="0em">âˆ‘</mo><mrow><mi mathvariant="normal">â„“</mi><mo>=</mo><mn>0</mn></mrow><mi mathvariant="normal">âˆ</mi></munderover><mrow><munder><mo movablelimits="false" rspace="0em">âˆ‘</mo><mrow><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>âˆˆ</mo><msup><mrow><mo>{</mo><mi class="ltx_font_mathcaligraphic">â„›</mi><mo>,</mo><mi class="ltx_font_mathcaligraphic">ğ’¯</mi><mo>}</mo></mrow><mi mathvariant="normal">â„“</mi></msup></mrow></munder><mrow><msub><mo>âˆ«</mo><mi mathvariant="normal">Î©</mi></msub><mrow><mi>e</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><mi>p</mi><mo>â¢</mo><mrow><mo>(</mo><mi>ğ¬</mi><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><mi>ğ­</mi><mo>)</mo></mrow></mrow><mo>)</mo></mrow><mo>â¢</mo><mi>ğ•€</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><mi>ğ­</mi><mo>âˆˆ</mo><msub><mi>C</mi><mi>i</mi></msub></mrow><mo>)</mo></mrow><mo>â¢</mo><mfrac><msup><mi>r</mi><mn>2</mn></msup><mrow><mi>cos</mi><mo lspace="0.167em">â¡</mo><mi>Î¸</mi></mrow></mfrac><mo lspace="0em">â¢</mo><mrow><mo rspace="0em">ğ‘‘</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup></mrow></mrow></mrow></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(36)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">In this context, <math alttext="\mathbf{t}" class="ltx_Math" display="inline" id="SS1.p3.m17"><mi>ğ­</mi></math> denotes the position on the measurement plane where the path intersects. The double summation is over all path depths <math alttext="\ell=0,1,\ldots" class="ltx_Math" display="inline" id="SS1.p3.m18"><mrow><mi mathvariant="normal">â„“</mi><mo>=</mo><mrow><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mi mathvariant="normal">â€¦</mi></mrow></mrow></math> (with <math alttext="\ell=0" class="ltx_Math" display="inline" id="SS1.p3.m19"><mrow><mi mathvariant="normal">â„“</mi><mo>=</mo><mn>0</mn></mrow></math> corresponding to <a href="#glo.acronym.LoS"><span class="ltx_glossaryref" href="#glo.acronym.LoS" title="line-of-sight">LoS</span></a>) and all possible sequences of interaction types <math alttext="\boldsymbol{\chi}^{(\ell)}" class="ltx_Math" display="inline" id="SS1.p3.m20"><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup></math>, excluding diffuse reflections. The indicator function <math alttext="\mathbb{I}\left(\mathbf{t}\in C_{i}\right)" class="ltx_Math" display="inline" id="SS1.p3.m21"><mrow><mi>ğ•€</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><mi>ğ­</mi><mo>âˆˆ</mo><msub><mi>C</mi><mi>i</mi></msub></mrow><mo>)</mo></mrow></mrow></math> equals <math alttext="1" class="ltx_Math" display="inline" id="SS1.p3.m22"><mn>1</mn></math> if <math alttext="\mathbf{t}" class="ltx_Math" display="inline" id="SS1.p3.m23"><mi>ğ­</mi></math> is within <math alttext="C_{i}" class="ltx_Math" display="inline" id="SS1.p3.m24"><msub><mi>C</mi><mi>i</mi></msub></math> and <math alttext="0" class="ltx_Math" display="inline" id="SS1.p3.m25"><mn>0</mn></math> otherwise. If the path does not intersect the measurement plane, then <math alttext="\mathbb{I}\left(\mathbf{t}\in C_{i}\right)=0" class="ltx_Math" display="inline" id="SS1.p3.m26"><mrow><mrow><mi>ğ•€</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><mi>ğ­</mi><mo>âˆˆ</mo><msub><mi>C</mi><mi>i</mi></msub></mrow><mo>)</mo></mrow></mrow><mo>=</mo><mn>0</mn></mrow></math>. The integration is carried out over the unit sphere, where <math alttext="d\widehat{\mathbf{k}}^{(0)}" class="ltx_Math" display="inline" id="SS1.p3.m27"><mrow><mi>d</mi><mo>â¢</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup></mrow></math> represents the infinitesimal solid angle element corresponding to the ray tube in the direction <math alttext="\widehat{\mathbf{k}}^{(0)}" class="ltx_Math" display="inline" id="SS1.p3.m28"><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup></math>.</p>
</div>
<div class="ltx_para" id="SS1.p4">
<p class="ltx_p">To extend the definition to include diffuse reflections, we first modify the definitionÂ (<a class="ltx_ref" href="#E36" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">36</span></a>) to explicitly include the sequence of propagation directions of the scattered rays at the interaction points, denoted as <math alttext="\bar{\mathbf{k}}^{(\ell)}=\left(\widehat{\mathbf{k}}^{(1)},\cdots,\widehat{%
\mathbf{k}}^{(\ell)}\right)" class="ltx_Math" display="inline" id="SS1.p4.m1"><mrow><msup><mover accent="true"><mi>ğ¤</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mrow><mo>(</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><mi mathvariant="normal">â‹¯</mi><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>)</mo></mrow></mrow></math>. For this purpose, we introduce <math alttext="\bar{\mathbf{n}}^{(\ell)}=\left(\widehat{\mathbf{n}}^{(1)},\cdots,\widehat{%
\mathbf{n}}^{(\ell)}\right)" class="ltx_Math" display="inline" id="SS1.p4.m2"><mrow><msup><mover accent="true"><mi>ğ§</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mrow><mo>(</mo><msup><mover accent="true"><mi>ğ§</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><mi mathvariant="normal">â‹¯</mi><mo>,</mo><msup><mover accent="true"><mi>ğ§</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>)</mo></mrow></mrow></math>, representing the sequence of normals at these interaction points. We then define the function <math alttext="\bar{f}\left(\cdot\right)" class="ltx_Math" display="inline" id="SS1.p4.m3"><mrow><mover accent="true"><mi>f</mi><mo>Â¯</mo></mover><mo>â¢</mo><mrow><mo>(</mo><mo lspace="0em" rspace="0em">â‹…</mo><mo>)</mo></mrow></mrow></math>, which ensures that the direction of the scattered rays aligns with the interaction type, as follows:</p>
<table class="ltx_equation ltx_eqn_table" id="E37">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\bar{f}\left(\widehat{\mathbf{k}}^{(0)},\bar{\mathbf{k}}^{(\ell)},\boldsymbol{%
\chi}^{(\ell)},\bar{\mathbf{n}}^{(\ell)}\right)=\prod_{\ell^{\prime}=1}^{\ell}%
f\left(\chi^{(\ell^{\prime})},\widehat{\mathbf{k}}^{(\ell^{\prime}-1)},%
\widehat{\mathbf{k}}^{(\ell^{\prime})},\widehat{\mathbf{n}}^{(\ell^{\prime})}\right)" class="ltx_Math" display="block" id="E37.m1"><mrow><mrow><mover accent="true"><mi>f</mi><mo>Â¯</mo></mover><mo>â¢</mo><mrow><mo>(</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mover accent="true"><mi>ğ§</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>)</mo></mrow></mrow><mo rspace="0.111em">=</mo><mrow><munderover><mo movablelimits="false">âˆ</mo><mrow><msup><mi mathvariant="normal">â„“</mi><mo>â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi mathvariant="normal">â„“</mi></munderover><mrow><mi>f</mi><mo>â¢</mo><mrow><mo>(</mo><msup><mi>Ï‡</mi><mrow><mo stretchy="false">(</mo><msup><mi mathvariant="normal">â„“</mi><mo>â€²</mo></msup><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mrow><msup><mi mathvariant="normal">â„“</mi><mo>â€²</mo></msup><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><msup><mi mathvariant="normal">â„“</mi><mo>â€²</mo></msup><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mover accent="true"><mi>ğ§</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><msup><mi mathvariant="normal">â„“</mi><mo>â€²</mo></msup><mo stretchy="false">)</mo></mrow></msup><mo>)</mo></mrow></mrow></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(37)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where</p>
<table class="ltx_equation ltx_eqn_table" id="E38">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f\left(\chi,\widehat{\mathbf{k}}_{i},\widehat{\mathbf{k}}_{s},\widehat{\mathbf%
{n}}\right)=\begin{cases}\delta\left(\widehat{\mathbf{k}}_{s}-\left(\widehat{%
\mathbf{k}}_{i}-2\left(\widehat{\mathbf{n}}^{\mathsf{T}}\widehat{\mathbf{k}}_{%
i}\right)\widehat{\mathbf{n}}\right)\right)&amp;\text{if }\chi={\cal R}\\
\delta\left(\widehat{\mathbf{k}}_{s}-\widehat{\mathbf{k}}_{i}\right)&amp;\text{if %
}\chi={\cal T}\\
\end{cases}" class="ltx_Math" display="block" id="E38.m1"><mrow><mrow><mi>f</mi><mo>â¢</mo><mrow><mo>(</mo><mi>Ï‡</mi><mo>,</mo><msub><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>i</mi></msub><mo>,</mo><msub><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>s</mi></msub><mo>,</mo><mover accent="true"><mi>ğ§</mi><mo>^</mo></mover><mo>)</mo></mrow></mrow><mo>=</mo><mrow><mo>{</mo><mtable columnspacing="5pt" displaystyle="true" rowspacing="0pt"><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><mi>Î´</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><msub><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>s</mi></msub><mo>âˆ’</mo><mrow><mo>(</mo><mrow><msub><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>i</mi></msub><mo>âˆ’</mo><mrow><mn>2</mn><mo>â¢</mo><mrow><mo>(</mo><mrow><msup><mover accent="true"><mi>ğ§</mi><mo>^</mo></mover><mi>ğ–³</mi></msup><mo>â¢</mo><msub><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>i</mi></msub></mrow><mo>)</mo></mrow><mo>â¢</mo><mover accent="true"><mi>ğ§</mi><mo>^</mo></mover></mrow></mrow><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow></mtd><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><mtext>ifÂ </mtext><mo>â¢</mo><mi>Ï‡</mi></mrow><mo>=</mo><mi class="ltx_font_mathcaligraphic">â„›</mi></mrow></mtd></mtr><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><mi>Î´</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><msub><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>s</mi></msub><mo>âˆ’</mo><msub><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>i</mi></msub></mrow><mo>)</mo></mrow></mrow></mtd><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><mtext>ifÂ </mtext><mo>â¢</mo><mi>Ï‡</mi></mrow><mo>=</mo><mi class="ltx_font_mathcaligraphic">ğ’¯</mi></mrow></mtd></mtr></mtable></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(38)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">and, <math alttext="\delta\left(\cdot\right)" class="ltx_Math" display="inline" id="SS1.p4.m4"><mrow><mi>Î´</mi><mo>â¢</mo><mrow><mo>(</mo><mo lspace="0em" rspace="0em">â‹…</mo><mo>)</mo></mrow></mrow></math> is the Dirac delta distribution.
The definition inÂ (<a class="ltx_ref" href="#E36" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">36</span></a>) can be then be reformulated as</p>
<table class="ltx_equation ltx_eqn_table" id="E39">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="C_{i}=\\
\frac{1}{\left|C\right|}\sum_{\ell=0}^{\infty}\sum_{\boldsymbol{\chi}^{(\ell)}%
\in\left\{{\cal R},{\cal T}\right\}^{\ell}}\int_{\Omega}\int_{\Omega^{\ell}}e%
\left(p\left(\mathbf{s},\widehat{\mathbf{k}}^{(0)},\boldsymbol{\chi}^{(\ell)},%
\mathbf{t}\right)\right)\mathbb{I}\left(\mathbf{t}\in C_{i}\right)\bar{f}\left%
(\widehat{\mathbf{k}}^{(0)},\bar{\mathbf{k}}^{(\ell)},\boldsymbol{\chi}^{(\ell%
)},\bar{\mathbf{n}}^{(\ell)}\right)\frac{r^{2}}{\cos\theta}d\bar{\mathbf{k}}^{%
(\ell)}d\widehat{\mathbf{k}}^{(0)}" class="ltx_Math" display="block" id="E39.m1"><mtable displaystyle="true" rowspacing="0pt"><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><mi></mi></mrow></mtd></mtr><mtr><mtd class="ltx_align_right" columnalign="right"><mrow><mfrac><mn>1</mn><mrow><mo>|</mo><mi>C</mi><mo>|</mo></mrow></mfrac><mo>â¢</mo><mrow><munderover><mo movablelimits="false" rspace="0em">âˆ‘</mo><mrow><mi mathvariant="normal">â„“</mi><mo>=</mo><mn>0</mn></mrow><mi mathvariant="normal">âˆ</mi></munderover><mrow><munder><mo movablelimits="false" rspace="0em">âˆ‘</mo><mrow><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>âˆˆ</mo><msup><mrow><mo>{</mo><mi class="ltx_font_mathcaligraphic">â„›</mi><mo>,</mo><mi class="ltx_font_mathcaligraphic">ğ’¯</mi><mo>}</mo></mrow><mi mathvariant="normal">â„“</mi></msup></mrow></munder><mrow><msub><mo rspace="0em">âˆ«</mo><mi mathvariant="normal">Î©</mi></msub><mrow><msub><mo>âˆ«</mo><msup><mi mathvariant="normal">Î©</mi><mi mathvariant="normal">â„“</mi></msup></msub><mrow><mi>e</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><mi>p</mi><mo>â¢</mo><mrow><mo>(</mo><mi>ğ¬</mi><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><mi>ğ­</mi><mo>)</mo></mrow></mrow><mo>)</mo></mrow><mo>â¢</mo><mi>ğ•€</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><mi>ğ­</mi><mo>âˆˆ</mo><msub><mi>C</mi><mi>i</mi></msub></mrow><mo>)</mo></mrow><mo>â¢</mo><mover accent="true"><mi>f</mi><mo>Â¯</mo></mover><mo>â¢</mo><mrow><mo>(</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mover accent="true"><mi>ğ§</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>)</mo></mrow><mo>â¢</mo><mfrac><msup><mi>r</mi><mn>2</mn></msup><mrow><mi>cos</mi><mo lspace="0.167em">â¡</mo><mi>Î¸</mi></mrow></mfrac><mo lspace="0em">â¢</mo><mrow><mo rspace="0em">ğ‘‘</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mo lspace="0em">â¢</mo><mrow><mo rspace="0em">ğ‘‘</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup></mrow></mrow></mrow></mrow></mrow></mrow></mrow></mtd></mtr></mtable></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(39)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Compared toÂ (<a class="ltx_ref" href="#E36" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">36</span></a>), the definition inÂ (<a class="ltx_ref" href="#E39" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">39</span></a>) integrates over all propagation directions of the scattered rays at the interaction points.
The integral over <math alttext="\Omega^{\ell}" class="ltx_Math" display="inline" id="SS1.p4.m5"><msup><mi mathvariant="normal">Î©</mi><mi mathvariant="normal">â„“</mi></msup></math> combined with the function <math alttext="\bar{f}\left(\cdot\right)" class="ltx_Math" display="inline" id="SS1.p4.m6"><mrow><mover accent="true"><mi>f</mi><mo>Â¯</mo></mover><mo>â¢</mo><mrow><mo>(</mo><mo lspace="0em" rspace="0em">â‹…</mo><mo>)</mo></mrow></mrow></math> merely filters out invalid directions and, strictly speaking, does not perform any other function.
However, while the definition inÂ (<a class="ltx_ref" href="#E39" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">39</span></a>) is equivalent toÂ (<a class="ltx_ref" href="#E36" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">36</span></a>), it facilitates the extension to paths with diffuse reflections:</p>
<table class="ltx_equation ltx_eqn_table" id="E40">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="C_{i}=\\
\frac{1}{\left|C\right|}\sum_{\ell=0}^{\infty}\sum_{\boldsymbol{\chi}^{(\ell)}%
\in{\cal I}^{\ell}}\int_{\Omega}\int_{\Omega^{\ell}}e\left(p\left(\mathbf{s},%
\widehat{\mathbf{k}}^{(0)},\bar{\mathbf{k}}^{(\ell)},\boldsymbol{\chi}^{(\ell)%
},\mathbf{t}\right)\right)\mathbb{I}\left(\mathbf{t}\in C_{i}\right)\bar{f}%
\left(\widehat{\mathbf{k}}^{(0)},\bar{\mathbf{k}}^{(\ell)},\boldsymbol{\chi}^{%
(\ell)},\bar{\mathbf{n}}^{(\ell)}\right)\frac{r^{2}}{\cos\theta}d\bar{\mathbf{%
k}}^{(\ell)}d\widehat{\mathbf{k}}^{(0)}" class="ltx_Math" display="block" id="E40.m1"><mtable displaystyle="true" rowspacing="0pt"><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><mi></mi></mrow></mtd></mtr><mtr><mtd class="ltx_align_right" columnalign="right"><mrow><mfrac><mn>1</mn><mrow><mo>|</mo><mi>C</mi><mo>|</mo></mrow></mfrac><mo>â¢</mo><mrow><munderover><mo movablelimits="false" rspace="0em">âˆ‘</mo><mrow><mi mathvariant="normal">â„“</mi><mo>=</mo><mn>0</mn></mrow><mi mathvariant="normal">âˆ</mi></munderover><mrow><munder><mo movablelimits="false" rspace="0em">âˆ‘</mo><mrow><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>âˆˆ</mo><msup><mi class="ltx_font_mathcaligraphic">â„</mi><mi mathvariant="normal">â„“</mi></msup></mrow></munder><mrow><msub><mo rspace="0em">âˆ«</mo><mi mathvariant="normal">Î©</mi></msub><mrow><msub><mo>âˆ«</mo><msup><mi mathvariant="normal">Î©</mi><mi mathvariant="normal">â„“</mi></msup></msub><mrow><mi>e</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><mi>p</mi><mo>â¢</mo><mrow><mo>(</mo><mi>ğ¬</mi><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><mi>ğ­</mi><mo>)</mo></mrow></mrow><mo>)</mo></mrow><mo>â¢</mo><mi>ğ•€</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><mi>ğ­</mi><mo>âˆˆ</mo><msub><mi>C</mi><mi>i</mi></msub></mrow><mo>)</mo></mrow><mo>â¢</mo><mover accent="true"><mi>f</mi><mo>Â¯</mo></mover><mo>â¢</mo><mrow><mo>(</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mover accent="true"><mi>ğ§</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>)</mo></mrow><mo>â¢</mo><mfrac><msup><mi>r</mi><mn>2</mn></msup><mrow><mi>cos</mi><mo lspace="0.167em">â¡</mo><mi>Î¸</mi></mrow></mfrac><mo lspace="0em">â¢</mo><mrow><mo rspace="0em">ğ‘‘</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mo lspace="0em">â¢</mo><mrow><mo rspace="0em">ğ‘‘</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup></mrow></mrow></mrow></mrow></mrow></mrow></mrow></mtd></mtr></mtable></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(40)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where the inner sum covers all possible sequences of interaction types of depth <math alttext="\ell" class="ltx_Math" display="inline" id="SS1.p4.m7"><mi mathvariant="normal">â„“</mi></math>, including diffuse reflections. The path <math alttext="p\left(\mathbf{s},\widehat{\mathbf{k}}^{(0)},\bar{\mathbf{k}}^{(\ell)},%
\boldsymbol{\chi}^{(\ell)},\mathbf{t}\right)" class="ltx_Math" display="inline" id="SS1.p4.m8"><mrow><mi>p</mi><mo>â¢</mo><mrow><mo>(</mo><mi>ğ¬</mi><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><mi>ğ­</mi><mo>)</mo></mrow></mrow></math> represents a path of depth <math alttext="\ell" class="ltx_Math" display="inline" id="SS1.p4.m9"><mi mathvariant="normal">â„“</mi></math> from the source <math alttext="\mathbf{s}" class="ltx_Math" display="inline" id="SS1.p4.m10"><mi>ğ¬</mi></math> to the target <math alttext="\mathbf{t}\in{\cal M}" class="ltx_Math" display="inline" id="SS1.p4.m11"><mrow><mi>ğ­</mi><mo>âˆˆ</mo><mi class="ltx_font_mathcaligraphic">â„³</mi></mrow></math>. This path is defined by the initial propagation direction <math alttext="\widehat{\mathbf{k}}^{(0)}" class="ltx_Math" display="inline" id="SS1.p4.m12"><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup></math>, the sequence of scattered ray directions <math alttext="\bar{\mathbf{k}}^{(\ell)}" class="ltx_Math" display="inline" id="SS1.p4.m13"><msup><mover accent="true"><mi>ğ¤</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup></math>, and the sequence of interaction types <math alttext="\boldsymbol{\chi}^{(\ell)}" class="ltx_Math" display="inline" id="SS1.p4.m14"><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup></math>.
Compared toÂ (<a class="ltx_ref" href="#E39" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">39</span></a>), the paths depend on the directions of propagation of the scattered waves, which are not solely determined by the initial propagation directions and interaction types when diffuse reflection occurs.
InÂ (<a class="ltx_ref" href="#E40" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">40</span></a>), <math alttext="f\left(\cdot\right)" class="ltx_Math" display="inline" id="SS1.p4.m15"><mrow><mi>f</mi><mo>â¢</mo><mrow><mo>(</mo><mo lspace="0em" rspace="0em">â‹…</mo><mo>)</mo></mrow></mrow></math> inÂ (<a class="ltx_ref" href="#E37" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">37</span></a>) is extended to include diffuse reflections as follows:</p>
<table class="ltx_equation ltx_eqn_table" id="E41">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f\left(\chi,\widehat{\mathbf{k}}_{i},\widehat{\mathbf{k}}_{s},\widehat{\mathbf%
{n}}\right)=\begin{cases}\delta\left(\widehat{\mathbf{k}}_{s}-\left(\widehat{%
\mathbf{k}}_{i}-2\left(\widehat{\mathbf{n}}^{\mathsf{T}}\widehat{\mathbf{k}}_{%
i}\right)\widehat{\mathbf{n}}\right)\right)&amp;\text{if }\chi={\cal R}\\
\delta\left(\widehat{\mathbf{k}}_{s}-\widehat{\mathbf{k}}_{i}\right)&amp;\text{if %
}\chi={\cal T}\\
\mathbb{I}\left(\widehat{\mathbf{k}}_{i}^{\mathsf{T}}\widehat{\mathbf{n}}&gt;0%
\right)&amp;\text{if }\chi={\cal S}\end{cases}" class="ltx_Math" display="block" id="E41.m1"><mrow><mrow><mi>f</mi><mo>â¢</mo><mrow><mo>(</mo><mi>Ï‡</mi><mo>,</mo><msub><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>i</mi></msub><mo>,</mo><msub><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>s</mi></msub><mo>,</mo><mover accent="true"><mi>ğ§</mi><mo>^</mo></mover><mo>)</mo></mrow></mrow><mo>=</mo><mrow><mo>{</mo><mtable columnspacing="5pt" displaystyle="true" rowspacing="0pt"><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><mi>Î´</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><msub><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>s</mi></msub><mo>âˆ’</mo><mrow><mo>(</mo><mrow><msub><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>i</mi></msub><mo>âˆ’</mo><mrow><mn>2</mn><mo>â¢</mo><mrow><mo>(</mo><mrow><msup><mover accent="true"><mi>ğ§</mi><mo>^</mo></mover><mi>ğ–³</mi></msup><mo>â¢</mo><msub><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>i</mi></msub></mrow><mo>)</mo></mrow><mo>â¢</mo><mover accent="true"><mi>ğ§</mi><mo>^</mo></mover></mrow></mrow><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow></mtd><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><mtext>ifÂ </mtext><mo>â¢</mo><mi>Ï‡</mi></mrow><mo>=</mo><mi class="ltx_font_mathcaligraphic">â„›</mi></mrow></mtd></mtr><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><mi>Î´</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><msub><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>s</mi></msub><mo>âˆ’</mo><msub><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>i</mi></msub></mrow><mo>)</mo></mrow></mrow></mtd><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><mtext>ifÂ </mtext><mo>â¢</mo><mi>Ï‡</mi></mrow><mo>=</mo><mi class="ltx_font_mathcaligraphic">ğ’¯</mi></mrow></mtd></mtr><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><mi>ğ•€</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><mrow><msubsup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>i</mi><mi>ğ–³</mi></msubsup><mo>â¢</mo><mover accent="true"><mi>ğ§</mi><mo>^</mo></mover></mrow><mo>&gt;</mo><mn>0</mn></mrow><mo>)</mo></mrow></mrow></mtd><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><mtext>ifÂ </mtext><mo>â¢</mo><mi>Ï‡</mi></mrow><mo>=</mo><mi class="ltx_font_mathcaligraphic">ğ’®</mi></mrow></mtd></mtr></mtable></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(41)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where <math alttext="\mathbb{I}\left(\cdot\right)" class="ltx_Math" display="inline" id="SS1.p4.m16"><mrow><mi>ğ•€</mi><mo>â¢</mo><mrow><mo>(</mo><mo lspace="0em" rspace="0em">â‹…</mo><mo>)</mo></mrow></mrow></math> is the indicator function, which equals <math alttext="1" class="ltx_Math" display="inline" id="SS1.p4.m17"><mn>1</mn></math> if the condition is true and <math alttext="0" class="ltx_Math" display="inline" id="SS1.p4.m18"><mn>0</mn></math> otherwise. Note that inÂ (<a class="ltx_ref" href="#E40" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">40</span></a>), <math alttext="r" class="ltx_Math" display="inline" id="SS1.p4.m19"><mi>r</mi></math> is the length of the ray tube impinging on the measurement plane, which, in the case of paths including diffuse reflections, corresponds to the distance from the intersection with the measurement plane to the last diffuse reflection point.</p>
</div>
<div class="ltx_para" id="SS1.p5">
<p class="ltx_p">In practice, we estimate <math alttext="C_{i}" class="ltx_Math" display="inline" id="SS1.p5.m1"><msub><mi>C</mi><mi>i</mi></msub></math> using Monte Carlo integration. Similar to the path solver, we employ random sampling of interaction types (see SectionÂ <a class="ltx_ref" href="S3.html#SS1.SSS2" title="3.1.2 Sampling Interaction Types â€£ 3.1 Generating Candidates by Shooting and Bouncing of Rays (SBR) â€£ 3 Path Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">3.1.2</span></a>) and limit the integration to paths with a maximum depth of <math alttext="L&lt;\infty" class="ltx_Math" display="inline" id="SS1.p5.m2"><mrow><mi>L</mi><mo>&lt;</mo><mi mathvariant="normal">âˆ</mi></mrow></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="E42">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="C_{i}=\frac{1}{\left|C\right|}\sum_{\ell=0}^{L}\Pr\left(\boldsymbol{\chi}^{(%
\ell)}\right)\\
\sum_{\boldsymbol{\chi}^{(\ell)}\in{\cal I}^{\ell}}\int_{\Omega}\int_{\Omega^{%
\ell}}e\left(p\left(\mathbf{s},\widehat{\mathbf{k}}^{(0)},\bar{\mathbf{k}}^{(%
\ell)},\boldsymbol{\chi}^{(\ell)},\mathbf{t}\right)\right)\mathbb{I}\left(%
\mathbf{t}\in C_{i}\right)\bar{f}\left(\widehat{\mathbf{k}}^{(0)},\bar{\mathbf%
{k}}^{(\ell)},\boldsymbol{\chi}^{(\ell)},\bar{\mathbf{n}}^{(\ell)}\right)\frac%
{r^{2}}{\Pr\left(\boldsymbol{\chi}^{(\ell)}\right)\cos\theta}d\bar{\mathbf{k}}%
^{(\ell)}d\widehat{\mathbf{k}}^{(0)}" class="ltx_Math" display="block" id="E42.m1"><mtable displaystyle="true" rowspacing="0pt"><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><mrow><mfrac><mn>1</mn><mrow><mo>|</mo><mi>C</mi><mo>|</mo></mrow></mfrac><mo>â¢</mo><mrow><munderover><mo movablelimits="false">âˆ‘</mo><mrow><mi mathvariant="normal">â„“</mi><mo>=</mo><mn>0</mn></mrow><mi>L</mi></munderover><mrow><mi>Pr</mi><mo>â¡</mo><mrow><mo>(</mo><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>)</mo></mrow></mrow></mrow></mrow></mrow></mtd></mtr><mtr><mtd class="ltx_align_right" columnalign="right"><mrow><munder><mo movablelimits="false">âˆ‘</mo><mrow><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>âˆˆ</mo><msup><mi class="ltx_font_mathcaligraphic">â„</mi><mi mathvariant="normal">â„“</mi></msup></mrow></munder><mrow><msub><mo lspace="0.167em" rspace="0em">âˆ«</mo><mi mathvariant="normal">Î©</mi></msub><mrow><msub><mo>âˆ«</mo><msup><mi mathvariant="normal">Î©</mi><mi mathvariant="normal">â„“</mi></msup></msub><mrow><mi>e</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><mi>p</mi><mo>â¢</mo><mrow><mo>(</mo><mi>ğ¬</mi><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><mi>ğ­</mi><mo>)</mo></mrow></mrow><mo>)</mo></mrow><mo>â¢</mo><mi>ğ•€</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><mi>ğ­</mi><mo>âˆˆ</mo><msub><mi>C</mi><mi>i</mi></msub></mrow><mo>)</mo></mrow><mo>â¢</mo><mover accent="true"><mi>f</mi><mo>Â¯</mo></mover><mo>â¢</mo><mrow><mo>(</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>,</mo><msup><mover accent="true"><mi>ğ§</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>)</mo></mrow><mo>â¢</mo><mfrac><msup><mi>r</mi><mn>2</mn></msup><mrow><mrow><mi>Pr</mi><mo>â¡</mo><mrow><mo>(</mo><msup><mi>ğŒ</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup><mo>)</mo></mrow></mrow><mo lspace="0.167em">â¢</mo><mrow><mi>cos</mi><mo lspace="0.167em">â¡</mo><mi>Î¸</mi></mrow></mrow></mfrac><mo lspace="0em">â¢</mo><mrow><mo rspace="0em">ğ‘‘</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>Â¯</mo></mover><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mo lspace="0em">â¢</mo><mrow><mo rspace="0em">ğ‘‘</mo><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msup></mrow></mrow></mrow></mrow></mrow></mtd></mtr></mtable></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(42)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Assuming <math alttext="N_{S}" class="ltx_Math" display="inline" id="SS1.p5.m3"><msub><mi>N</mi><mi>S</mi></msub></math> samples for Monte Carlo integration, we sample the unit sphere around the source <math alttext="\mathbf{s}" class="ltx_Math" display="inline" id="SS1.p5.m4"><mi>ğ¬</mi></math> using <math alttext="N_{S}" class="ltx_Math" display="inline" id="SS1.p5.m5"><msub><mi>N</mi><mi>S</mi></msub></math> samples, resulting in initial ray tubes with a solid angle of approximately <math alttext="4\pi/N_{S}" class="ltx_Math" display="inline" id="SS1.p5.m6"><mrow><mrow><mn>4</mn><mo>â¢</mo><mi>Ï€</mi></mrow><mo>/</mo><msub><mi>N</mi><mi>S</mi></msub></mrow></math>. For diffuse reflection points, we emit a single ray on the hemisphere, leading to ray tubes with a solid angle of <math alttext="2\pi" class="ltx_Math" display="inline" id="SS1.p5.m7"><mrow><mn>2</mn><mo>â¢</mo><mi>Ï€</mi></mrow></math>. This results in the following estimator</p>
<table class="ltx_equation ltx_eqn_table" id="E43">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\widehat{C}_{i}=\frac{1}{\left|C\right|}\frac{4\pi}{N_{S}}\sum_{n=1}^{N_{S}}%
\sum_{\ell=0}^{L}e\left(p\left(\mathbf{s},\widehat{\mathbf{k}}^{(0)}_{n},\bar{%
\mathbf{k}}^{(\ell)}_{n},\boldsymbol{\chi}^{(\ell)}_{n},\mathbf{t}_{n}\right)%
\right)\mathbb{I}\left(\mathbf{t}_{n}\in C_{i}\right)\frac{r_{n}^{2}\left(%
\prod_{\ell^{\prime}=1}^{\ell}\omega_{n}^{(\ell^{\prime})}\right)}{\Pr\left(%
\boldsymbol{\chi}_{n}\right)\cos\theta_{n}}." class="ltx_Math" display="block" id="E43.m1"><mrow><mrow><msub><mover accent="true"><mi>C</mi><mo>^</mo></mover><mi>i</mi></msub><mo>=</mo><mrow><mfrac><mn>1</mn><mrow><mo>|</mo><mi>C</mi><mo>|</mo></mrow></mfrac><mo>â¢</mo><mfrac><mrow><mn>4</mn><mo>â¢</mo><mi>Ï€</mi></mrow><msub><mi>N</mi><mi>S</mi></msub></mfrac><mo>â¢</mo><mrow><munderover><mo movablelimits="false" rspace="0em">âˆ‘</mo><mrow><mi>n</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>N</mi><mi>S</mi></msub></munderover><mrow><munderover><mo movablelimits="false">âˆ‘</mo><mrow><mi mathvariant="normal">â„“</mi><mo>=</mo><mn>0</mn></mrow><mi>L</mi></munderover><mrow><mi>e</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><mi>p</mi><mo>â¢</mo><mrow><mo>(</mo><mi>ğ¬</mi><mo>,</mo><msubsup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>n</mi><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msubsup><mover accent="true"><mi>ğ¤</mi><mo>Â¯</mo></mover><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msubsup><mi>ğŒ</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msub><mi>ğ­</mi><mi>n</mi></msub><mo>)</mo></mrow></mrow><mo>)</mo></mrow><mo>â¢</mo><mi>ğ•€</mi><mo>â¢</mo><mrow><mo>(</mo><mrow><msub><mi>ğ­</mi><mi>n</mi></msub><mo>âˆˆ</mo><msub><mi>C</mi><mi>i</mi></msub></mrow><mo>)</mo></mrow><mo>â¢</mo><mfrac><mrow><msubsup><mi>r</mi><mi>n</mi><mn>2</mn></msubsup><mo>â¢</mo><mrow><mo>(</mo><mrow><msubsup><mo lspace="0em">âˆ</mo><mrow><msup><mi mathvariant="normal">â„“</mi><mo>â€²</mo></msup><mo>=</mo><mn>1</mn></mrow><mi mathvariant="normal">â„“</mi></msubsup><msubsup><mi>Ï‰</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><msup><mi mathvariant="normal">â„“</mi><mo>â€²</mo></msup><mo stretchy="false">)</mo></mrow></msubsup></mrow><mo>)</mo></mrow></mrow><mrow><mrow><mi>Pr</mi><mo>â¡</mo><mrow><mo>(</mo><msub><mi>ğŒ</mi><mi>n</mi></msub><mo>)</mo></mrow></mrow><mo lspace="0.167em">â¢</mo><mrow><mi>cos</mi><mo lspace="0.167em">â¡</mo><msub><mi>Î¸</mi><mi>n</mi></msub></mrow></mrow></mfrac></mrow></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(43)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Here, the subscript <math alttext="n" class="ltx_Math" display="inline" id="SS1.p5.m8"><mi>n</mi></math> denotes the <math alttext="n" class="ltx_Math" display="inline" id="SS1.p5.m9"><mi>n</mi></math>-th path, and <math alttext="\omega_{n}^{(\ell^{\prime})}" class="ltx_Math" display="inline" id="SS1.p5.m10"><msubsup><mi>Ï‰</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><msup><mi mathvariant="normal">â„“</mi><mo>â€²</mo></msup><mo stretchy="false">)</mo></mrow></msubsup></math> represents the solid angles of the ray tubes corresponding to sampling the <math alttext="\ell^{\prime}" class="ltx_Math" display="inline" id="SS1.p5.m11"><msup><mi mathvariant="normal">â„“</mi><mo>â€²</mo></msup></math>-th integral:</p>
<table class="ltx_equation ltx_eqn_table" id="E44">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\omega_{n}^{(\ell^{\prime})}=\begin{cases}2\pi&amp;\text{if }\chi_{n}^{(\ell^{%
\prime})}={\cal S}\\
1&amp;\text{otherwise}.\end{cases}" class="ltx_Math" display="block" id="E44.m1"><mrow><msubsup><mi>Ï‰</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><msup><mi mathvariant="normal">â„“</mi><mo>â€²</mo></msup><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mrow><mo>{</mo><mtable columnspacing="5pt" displaystyle="true" rowspacing="0pt"><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><mn>2</mn><mo>â¢</mo><mi>Ï€</mi></mrow></mtd><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><mtext>ifÂ </mtext><mo>â¢</mo><msubsup><mi>Ï‡</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><msup><mi mathvariant="normal">â„“</mi><mo>â€²</mo></msup><mo stretchy="false">)</mo></mrow></msubsup></mrow><mo>=</mo><mi class="ltx_font_mathcaligraphic">ğ’®</mi></mrow></mtd></mtr><mtr><mtd class="ltx_align_left" columnalign="left"><mn>1</mn></mtd><mtd class="ltx_align_left" columnalign="left"><mrow><mtext>otherwise</mtext><mo lspace="0em">.</mo></mrow></mtd></mtr></mtable></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(44)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">In the case of diffuse reflections, the multiplication by the ray tube solid angle is already applied through the computation of the scattered electric fieldÂ (<a class="ltx_ref" href="A1.html#E123" title="In A.8 Diffuse Reflection â€£ Appendix A Primer on Electromagnetism â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">123</span></a>).
It has been included here for the sake of clarity.
As we will see in the next section, this estimator can be efficiently computed using a single <a href="#glo.acronym.SBR"><span class="ltx_glossaryref" href="#glo.acronym.SBR" title="shooting and bouncing of rays">SBR</span></a> loop.</p>
</div>
<section class="ltx_subsubsection" id="SS1.SSS1">
<h3 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.1.1 </span>Non-Coherent vs. Coherent Radio Maps</h3>
<div class="ltx_para" id="SS1.SSS1.p1">
<p class="ltx_p">The proposed definition of radio maps involves a non-coherent summation of path gainsÂ (<a class="ltx_ref" href="#E35" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">35</span></a>). As a result, it does not capture fast fading effects, which result from the constructive and destructive interference of multiple paths. FigureÂ <a class="ltx_ref" href="#F24" title="Figure 24 â€£ 4.1.1 Non-Coherent vs. Coherent Radio Maps â€£ 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">24</span></a> demonstrates this by comparing three scenarios: a radio map generated using the radio map solver (SectionÂ <a class="ltx_ref" href="#SS2" title="4.2 SBR-based Radio Map Solver â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">4.2</span></a>), a radio map created by non-coherently summing the path coefficientsÂ (<a class="ltx_ref" href="S1.html#E4" title="In 1 Introduction â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">4</span></a>) calculated with the path solver (SectionÂ <a class="ltx_ref" href="S3.html" title="3 Path Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">3</span></a>) by placing a single target at the center of each measurement cell, and a radio map produced by coherently summing the path coefficientsÂ (<a class="ltx_ref" href="S1.html#E4" title="In 1 Introduction â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">4</span></a>) calculated with the path solver, also by placing a single target at the center of each measurement cell. The radio map obtained using the radio map solver aligns with the non-coherent summation of path coefficients calculated using the path solver, as anticipated. However, it does not account for fast fading effects, which requires the coherent summation of path coefficients.</p>
</div>
<figure class="ltx_figure" id="F24"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="229" id="F24.g1" src="figures/radio-map-solver-fast-fading.png" width="449"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" style="font-size:90%;">Figure 24</span>: </span><span class="ltx_text" style="font-size:90%;">Comparison of radio maps: one computed using the radio map solver, one by non-coherently summing path coefficients from the path solver, and one by coherently summing path coefficients from the path solver. The transmitter is depicted as a red ball. All radio maps are computed with a maximum depth of <math alttext="L=3" class="ltx_Math" display="inline" id="F24.m3"><mrow><mi>L</mi><mo>=</mo><mn>3</mn></mrow></math>, cell sizes of <math alttext="10\times 10" class="ltx_Math" display="inline" id="F24.m4"><mrow><mn>10</mn><mo lspace="0.222em" rspace="0.222em">Ã—</mo><mn>10</mn></mrow></math> cm, using isotropic antenna patterns on both the transmitter and receiver, and for the â€œboxâ€ scene built in SionnaÂ RT. The â€œnon-coherent sumâ€ and â€œcoherent sumâ€ radio maps are generated by placing a single target point at the center of each measurement cell.</span></figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="SS1.SSS2">
<h3 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.1.2 </span>Handling Multiple Transmit Antennas</h3>
<div class="ltx_para" id="SS1.SSS2.p1">
<p class="ltx_p">The SionnaÂ RT radio map solver supports antenna arrays of any size at the transmitter and allows for user-defined precoding vectors. However, it only supports synthetic arrays. In this setup, paths are generated from a single source located at the center of the array, and the channel response for each individual antenna is calculated by applying the appropriate phase shifts synthetically. This approximation holds true as long as the array size is small compared to the distance from the transmitter to the measurement plane and scatterers.</p>
</div>
<div class="ltx_para" id="SS1.SSS2.p2">
<p class="ltx_p">Using synthetic arrays enables efficient scaling with respect to the number of antennas. To see this, let <math alttext="N_{A}^{\text{tx}}" class="ltx_Math" display="inline" id="SS1.SSS2.p2.m1"><msubsup><mi>N</mi><mi>A</mi><mtext>tx</mtext></msubsup></math> denote the number of antennas at the transmitter, and let <math alttext="\mathbf{u}_{P}\in\mathbb{C}^{N_{A}^{\text{tx}}}" class="ltx_Math" display="inline" id="SS1.SSS2.p2.m2"><mrow><msub><mi>ğ®</mi><mi>P</mi></msub><mo>âˆˆ</mo><msup><mi>â„‚</mi><msubsup><mi>N</mi><mi>A</mi><mtext>tx</mtext></msubsup></msup></mrow></math> be the precoding vector. For a given path connecting the source to the measurement plane, let <math alttext="\mathbf{E}\in\mathbb{C}^{2}" class="ltx_Math" display="inline" id="SS1.SSS2.p2.m3"><mrow><mi>ğ„</mi><mo>âˆˆ</mo><msup><mi>â„‚</mi><mn>2</mn></msup></mrow></math> represent the electric field observed at the measurement plane. By employing a synthetic array, the corresponding electric fields for each antenna element are obtained by applying the array response vectorÂ (<a class="ltx_ref" href="S3.html#E30" title="In 3.3.1 Handling Multiple Antennas at the Transmitter and Receiver â€£ 3.3 Channel Coefficients, Delays, and Doppler Shifts Computation â€£ 3 Path Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">30</span></a>), denoted as <math alttext="\mathbf{u}_{A}^{\text{tx}}" class="ltx_Math" display="inline" id="SS1.SSS2.p2.m4"><msubsup><mi>ğ®</mi><mi>A</mi><mtext>tx</mtext></msubsup></math>, leading to</p>
<table class="ltx_equation ltx_eqn_table" id="E45">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathbf{E}_{A}=\mathbf{E}\left(\mathbf{u}_{A}^{\text{tx}}\right)^{\mathsf{T}}." class="ltx_Math" display="block" id="E45.m1"><mrow><mrow><msub><mi>ğ„</mi><mi>A</mi></msub><mo>=</mo><mrow><mi>ğ„</mi><mo>â¢</mo><msup><mrow><mo>(</mo><msubsup><mi>ğ®</mi><mi>A</mi><mtext>tx</mtext></msubsup><mo>)</mo></mrow><mi>ğ–³</mi></msup></mrow></mrow><mo lspace="0em">.</mo></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(45)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Here, <math alttext="\mathbf{E}_{A}" class="ltx_Math" display="inline" id="SS1.SSS2.p2.m5"><msub><mi>ğ„</mi><mi>A</mi></msub></math> is a matrix of size <math alttext="2\times N_{A}^{\text{tx}}" class="ltx_Math" display="inline" id="SS1.SSS2.p2.m6"><mrow><mn>2</mn><mo lspace="0.222em" rspace="0.222em">Ã—</mo><msubsup><mi>N</mi><mi>A</mi><mtext>tx</mtext></msubsup></mrow></math>, where each column represents the electric fields radiated by each transmit antenna. The contribution of this path to the radio map is given by</p>
<table class="ltx_equation ltx_eqn_table" id="E46">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\left\lVert\mathbf{E}_{A}\mathbf{u}_{P}\right\rVert_{2}^{2}." class="ltx_Math" display="block" id="E46.m1"><mrow><msubsup><mrow><mo fence="true" rspace="0em">âˆ¥</mo><mrow><msub><mi>ğ„</mi><mi>A</mi></msub><mo>â¢</mo><msub><mi>ğ®</mi><mi>P</mi></msub></mrow><mo fence="true" lspace="0em" stretchy="true">âˆ¥</mo></mrow><mn>2</mn><mn>2</mn></msubsup><mo lspace="0em">.</mo></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(46)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">This expression allows the pathâ€™s contribution to the radio map to be represented as</p>
<table class="ltx_equation ltx_eqn_table" id="E47">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\left\lVert\mathbf{E}_{A}\mathbf{u}_{P}\right\rVert_{2}^{2}=\left\lVert\left(%
\mathbf{E}\left(\mathbf{u}_{A}^{\text{tx}}\right)^{\mathsf{T}}\mathbf{u}_{P}%
\right)\right\rVert_{2}^{2}=\left\lVert\mathbf{E}\alpha\right\rVert_{2}^{2}" class="ltx_Math" display="block" id="E47.m1"><mrow><msubsup><mrow><mo fence="true" rspace="0em">âˆ¥</mo><mrow><msub><mi>ğ„</mi><mi>A</mi></msub><mo>â¢</mo><msub><mi>ğ®</mi><mi>P</mi></msub></mrow><mo fence="true" lspace="0em" stretchy="true">âˆ¥</mo></mrow><mn>2</mn><mn>2</mn></msubsup><mo rspace="0.1389em">=</mo><msubsup><mrow><mo fence="true" lspace="0.1389em" rspace="0em">âˆ¥</mo><mrow><mo>(</mo><mrow><mi>ğ„</mi><mo>â¢</mo><msup><mrow><mo>(</mo><msubsup><mi>ğ®</mi><mi>A</mi><mtext>tx</mtext></msubsup><mo>)</mo></mrow><mi>ğ–³</mi></msup><mo>â¢</mo><msub><mi>ğ®</mi><mi>P</mi></msub></mrow><mo>)</mo></mrow><mo fence="true" lspace="0em" rspace="0.1389em" stretchy="true">âˆ¥</mo></mrow><mn>2</mn><mn>2</mn></msubsup><mo lspace="0.1389em" rspace="0.1389em">=</mo><msubsup><mrow><mo fence="true" lspace="0.1389em" rspace="0em">âˆ¥</mo><mrow><mi>ğ„</mi><mo>â¢</mo><mi>Î±</mi></mrow><mo fence="true" lspace="0em" stretchy="true">âˆ¥</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(47)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where <math alttext="\alpha=\left(\mathbf{u}_{A}^{\text{tx}}\right)^{\mathsf{T}}\mathbf{u}_{P}" class="ltx_Math" display="inline" id="SS1.SSS2.p2.m7"><mrow><mi>Î±</mi><mo>=</mo><mrow><msup><mrow><mo>(</mo><msubsup><mi>ğ®</mi><mi>A</mi><mtext>tx</mtext></msubsup><mo>)</mo></mrow><mi>ğ–³</mi></msup><mo>â¢</mo><msub><mi>ğ®</mi><mi>P</mi></msub></mrow></mrow></math> is a scalar. Note that <math alttext="\alpha" class="ltx_Math" display="inline" id="SS1.SSS2.p2.m8"><mi>Î±</mi></math> depends on the departure direction of the path from the transmitter and thus varies for paths originating from the source. However, it remains independent of the array size. By precomputing <math alttext="\alpha" class="ltx_Math" display="inline" id="SS1.SSS2.p2.m9"><mi>Î±</mi></math> for each path, the effect of the transmitter array can be efficiently simulated by multiplying the electric field of each path by <math alttext="\alpha" class="ltx_Math" display="inline" id="SS1.SSS2.p2.m10"><mi>Î±</mi></math> once.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="SS2">
<h2 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>SBR-based Radio Map Solver</h2>
<div class="ltx_para" id="SS2.p1">
<p class="ltx_p">The SionnaÂ RT built-in radio map solver calculates the estimatorÂ (<a class="ltx_ref" href="#E43" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">43</span></a>) using a single <a href="#glo.acronym.SBR"><span class="ltx_glossaryref" href="#glo.acronym.SBR" title="shooting and bouncing of rays">SBR</span></a> loop.
Unlike the path solver described in SectionÂ <a class="ltx_ref" href="S3.html" title="3 Path Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">3</span></a>, it does not require an image method-based algorithm, as it only needs to test intersections with the measurement plane rather than connecting paths to precisely located target points.
Additionally, the electric field for each ray tube is computed dynamically during the <a href="#glo.acronym.SBR"><span class="ltx_glossaryref" href="#glo.acronym.SBR" title="shooting and bouncing of rays">SBR</span></a> loop as the paths are traced.</p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg3">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold">Algorithm 3</span> </span> Radio map solver SBR loop</figcaption>
<div class="ltx_listing ltx_listing">
<div class="ltx_listingline" id="alg3.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">1:</span></span>
<math alttext="\widehat{\mathbf{k}}^{(0)}_{n}\leftarrow\textsc{Fibonacci\_Lattice}(N_{S})" class="ltx_Math" display="inline" id="alg3.l1.m1"><mrow><msubsup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>n</mi><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">â†</mo><mrow><mtext class="ltx_font_smallcaps">Fibonacci_Lattice</mtext><mo>â¢</mo><mrow><mo stretchy="false">(</mo><msub><mi>N</mi><mi>S</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></math> <span class="ltx_text" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg3.l1.m2"><mo>â–·</mo></math> Sample departure direction
</span>
</div>
<div class="ltx_listingline" id="alg3.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">2:</span></span>
<math alttext="\mathbf{E}_{n}^{(0)}\leftarrow\textsc{tx\_pattern}(\widehat{\mathbf{k}}^{(0)}_%
{n})" class="ltx_Math" display="inline" id="alg3.l2.m1"><mrow><msubsup><mi>ğ„</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">â†</mo><mrow><mtext class="ltx_font_smallcaps">tx_pattern</mtext><mo>â¢</mo><mrow><mo stretchy="false">(</mo><msubsup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>n</mi><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo></mrow></mrow></mrow></math> <span class="ltx_text" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg3.l2.m2"><mo>â–·</mo></math> Electric field
</span>
</div>
<div class="ltx_listingline" id="alg3.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">3:</span></span>
<math alttext="r_{n}^{(0)}\leftarrow 0" class="ltx_Math" display="inline" id="alg3.l3.m1"><mrow><msubsup><mi>r</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">â†</mo><mn>0</mn></mrow></math> <span class="ltx_text" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg3.l3.m2"><mo>â–·</mo></math> Ray tube length
</span>
</div>
<div class="ltx_listingline" id="alg3.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">4:</span></span>
<math alttext="\omega_{n}^{(0)}\leftarrow\frac{4\pi}{N_{S}}" class="ltx_Math" display="inline" id="alg3.l4.m1"><mrow><msubsup><mi>Ï‰</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">â†</mo><mfrac><mrow><mn>4</mn><mo>â¢</mo><mi>Ï€</mi></mrow><msub><mi>N</mi><mi>S</mi></msub></mfrac></mrow></math> <span class="ltx_text" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg3.l4.m2"><mo>â–·</mo></math> Ray tube solid angle
</span>
</div>
<div class="ltx_listingline" id="alg3.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">5:</span></span>
<math alttext="\mathbf{C}=\left(\widehat{C}_{1},\cdots,\widehat{C}_{N_{M}}\right)=\left(0,%
\cdots,0\right)" class="ltx_Math" display="inline" id="alg3.l5.m1"><mrow><mi>ğ‚</mi><mo>=</mo><mrow><mo>(</mo><msub><mover accent="true"><mi>C</mi><mo>^</mo></mover><mn>1</mn></msub><mo>,</mo><mi mathvariant="normal">â‹¯</mi><mo>,</mo><msub><mover accent="true"><mi>C</mi><mo>^</mo></mover><msub><mi>N</mi><mi>M</mi></msub></msub><mo>)</mo></mrow><mo>=</mo><mrow><mo>(</mo><mn>0</mn><mo>,</mo><mi mathvariant="normal">â‹¯</mi><mo>,</mo><mn>0</mn><mo>)</mo></mrow></mrow></math> <span class="ltx_text" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg3.l5.m2"><mo>â–·</mo></math> Radio map
</span>
</div>
<div class="ltx_listingline" id="alg3.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">6:</span></span>
<math alttext="\texttt{active}_{n}\leftarrow\texttt{True}" class="ltx_Math" display="inline" id="alg3.l6.m1"><mrow><msub><mtext class="ltx_mathvariant_monospace">active</mtext><mi>n</mi></msub><mo stretchy="false">â†</mo><mtext class="ltx_mathvariant_monospace">True</mtext></mrow></math> <span class="ltx_text" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg3.l6.m2"><mo>â–·</mo></math> Path active flag
</span>
</div>
<div class="ltx_listingline" id="alg3.l7">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">7:</span></span>
<math alttext="\mathbf{v}_{n}^{(0)}\leftarrow\mathbf{s}" class="ltx_Math" display="inline" id="alg3.l7.m1"><mrow><msubsup><mi>ğ¯</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">â†</mo><mi>ğ¬</mi></mrow></math> <span class="ltx_text" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg3.l7.m2"><mo>â–·</mo></math> Path vertex
</span>
</div>
<div class="ltx_listingline" id="alg3.l8">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">8:</span></span>
<math alttext="\ell\leftarrow 1" class="ltx_Math" display="inline" id="alg3.l8.m1"><mrow><mi mathvariant="normal">â„“</mi><mo stretchy="false">â†</mo><mn>1</mn></mrow></math> <span class="ltx_text" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg3.l8.m2"><mo>â–·</mo></math> Path depth
</span>
</div>
<div class="ltx_listingline" id="alg3.l9">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">9:</span></span>
<span class="ltx_text ltx_font_bold">while</span>Â <math alttext="\ell\leq L\textbf{ and }\texttt{active}_{n}" class="ltx_Math" display="inline" id="alg3.l9.m1"><mrow><mi mathvariant="normal">â„“</mi><mo>â‰¤</mo><mrow><mi>L</mi><mo>â¢</mo><msub><mrow><mtext class="ltx_mathvariant_bold">Â andÂ </mtext><mtext class="ltx_mathvariant_monospace">active</mtext></mrow><mi>n</mi></msub></mrow></mrow></math>Â <span class="ltx_text ltx_font_bold">do</span>
</div>
<div class="ltx_listingline" id="alg3.l10">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">10:</span></span>
              
              
            Â Â Â Â Â <math alttext="\texttt{mp\_inter}_{n},\mathbf{v}_{\text{mp},n}^{(\ell)}\leftarrow\textsc{MP\_%
Intersection}(\mathbf{v}_{n}^{(\ell-1)},\widehat{\mathbf{k}}_{n}^{(\ell-1)})" class="ltx_Math" display="inline" id="alg3.l10.m1"><mrow><mrow><msub><mtext class="ltx_mathvariant_monospace">mp_inter</mtext><mi>n</mi></msub><mo>,</mo><msubsup><mi>ğ¯</mi><mrow><mtext>mp</mtext><mo>,</mo><mi>n</mi></mrow><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><mo stretchy="false">â†</mo><mrow><mtext class="ltx_font_smallcaps">MP_Intersection</mtext><mo>â¢</mo><mrow><mo stretchy="false">(</mo><msubsup><mi>ğ¯</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">â„“</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msubsup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">â„“</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo></mrow></mrow></mrow></math>
</div>
<div class="ltx_listingline" id="alg3.l11">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">11:</span></span>
              
              
            Â Â Â Â Â <span class="ltx_text ltx_font_bold">if</span>Â <math alttext="\texttt{mp\_inter}_{n}=\texttt{True}" class="ltx_Math" display="inline" id="alg3.l11.m1"><mrow><msub><mtext class="ltx_mathvariant_monospace">mp_inter</mtext><mi>n</mi></msub><mo>=</mo><mtext class="ltx_mathvariant_monospace">True</mtext></mrow></math>Â <span class="ltx_text ltx_font_bold">then</span>
</div>
<div class="ltx_listingline" id="alg3.l12">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">12:</span></span>
              
              
            Â Â Â Â Â Â Â Â Â <math alttext="\mathbf{C}\leftarrow\textsc{Add\_To\_Radio\_Map}(\mathbf{C},\mathbf{E}_{n}^{(%
\ell-1)},\widehat{\mathbf{k}}_{n}^{(\ell-1)},r_{n}^{(\ell-1)},\omega_{n}^{(%
\ell-1)},\mathbf{v}_{\text{mp},n}^{(\ell)},\mathbf{v}_{n}^{(\ell-1)})" class="ltx_Math" display="inline" id="alg3.l12.m1"><mrow><mi>ğ‚</mi><mo stretchy="false">â†</mo><mrow><mtext class="ltx_font_smallcaps">Add_To_Radio_Map</mtext><mo>â¢</mo><mrow><mo stretchy="false">(</mo><mi>ğ‚</mi><mo>,</mo><msubsup><mi>ğ„</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">â„“</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msubsup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">â„“</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msubsup><mi>r</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">â„“</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msubsup><mi>Ï‰</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">â„“</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msubsup><mi>ğ¯</mi><mrow><mtext>mp</mtext><mo>,</mo><mi>n</mi></mrow><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msubsup><mi>ğ¯</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">â„“</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo></mrow></mrow></mrow></math>
</div>
<div class="ltx_listingline" id="alg3.l13">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">13:</span></span>
              
              
            Â Â Â Â Â <span class="ltx_text ltx_font_bold">end</span>Â <span class="ltx_text ltx_font_bold">if</span>
</div>
<div class="ltx_listingline" id="alg3.l14">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">14:</span></span>
              
              
            Â Â Â Â Â <math alttext="\texttt{sc\_inter}_{n},o_{n}^{(\ell)},\mathbf{v}_{n}^{(\ell)}\leftarrow\textsc%
{Scene\_Intersection}(\mathbf{v}_{n}^{(\ell-1)},\widehat{\mathbf{k}}_{n}^{(%
\ell-1)})" class="ltx_Math" display="inline" id="alg3.l14.m1"><mrow><mrow><msub><mtext class="ltx_mathvariant_monospace">sc_inter</mtext><mi>n</mi></msub><mo>,</mo><msubsup><mi>o</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msubsup><mi>ğ¯</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><mo stretchy="false">â†</mo><mrow><mtext class="ltx_font_smallcaps">Scene_Intersection</mtext><mo>â¢</mo><mrow><mo stretchy="false">(</mo><msubsup><mi>ğ¯</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">â„“</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msubsup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">â„“</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo></mrow></mrow></mrow></math>
</div>
<div class="ltx_listingline" id="alg3.l15">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">15:</span></span>
              
              
            Â Â Â Â Â <math alttext="\texttt{active}_{n}\leftarrow\texttt{active}_{n}\textbf{ and }\texttt{sc\_%
inter}_{n}" class="ltx_Math" display="inline" id="alg3.l15.m1"><mrow><msub><mtext class="ltx_mathvariant_monospace">active</mtext><mi>n</mi></msub><mo stretchy="false">â†</mo><mrow><msub><mtext class="ltx_mathvariant_monospace">active</mtext><mi>n</mi></msub><mo>â¢</mo><msub><mrow><mtext class="ltx_mathvariant_bold">Â andÂ </mtext><mtext class="ltx_mathvariant_monospace">sc_inter</mtext></mrow><mi>n</mi></msub></mrow></mrow></math>
</div>
<div class="ltx_listingline" id="alg3.l16">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">16:</span></span>
              
              
            Â Â Â Â Â <span class="ltx_text ltx_font_bold">if</span>Â <math alttext="\texttt{active}_{n}=\texttt{True}" class="ltx_Math" display="inline" id="alg3.l16.m1"><mrow><msub><mtext class="ltx_mathvariant_monospace">active</mtext><mi>n</mi></msub><mo>=</mo><mtext class="ltx_mathvariant_monospace">True</mtext></mrow></math>Â <span class="ltx_text ltx_font_bold">then</span>
</div>
<div class="ltx_listingline" id="alg3.l17">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">17:</span></span>
              
              
            Â Â Â Â Â Â Â Â Â <math alttext="\mathbf{T}_{n}^{(\ell)},\widehat{\mathbf{k}}_{n}^{(\ell)},\chi_{n}^{(\ell)}%
\leftarrow\textsc{Sample\_Evaluate\_Interaction}(o_{n}^{(\ell)},\mathbf{E}_{n}%
^{(i-1)},\widehat{\mathbf{k}}_{n}^{(i-1)},\omega_{n}^{(\ell-1)})" class="ltx_Math" display="inline" id="alg3.l17.m1"><mrow><mrow><msubsup><mi>ğ“</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msubsup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msubsup><mi>Ï‡</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><mo stretchy="false">â†</mo><mrow><mtext class="ltx_font_smallcaps">Sample_Evaluate_Interaction</mtext><mo>â¢</mo><mrow><mo stretchy="false">(</mo><msubsup><mi>o</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msubsup><mi>ğ„</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msubsup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup><mo>,</mo><msubsup><mi>Ï‰</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">â„“</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo></mrow></mrow></mrow></math>
</div>
<div class="ltx_listingline" id="alg3.l18">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">18:</span></span>
              
              
            Â Â Â Â Â Â Â Â Â <math alttext="\mathbf{E}_{n}^{(\ell)}\leftarrow\frac{\mathbf{T}_{n}^{(\ell)}\mathbf{E}_{n}^{%
(\ell-1)}}{\sqrt{q_{n}^{(\ell)}\left(\chi_{n}^{(\ell)}\right)}}" class="ltx_Math" display="inline" id="alg3.l18.m1"><mrow><msubsup><mi>ğ„</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">â†</mo><mfrac><mrow><msubsup><mi>ğ“</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>â¢</mo><msubsup><mi>ğ„</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">â„“</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup></mrow><msqrt><mrow><msubsup><mi>q</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>â¢</mo><mrow><mo>(</mo><msubsup><mi>Ï‡</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>)</mo></mrow></mrow></msqrt></mfrac></mrow></math>
</div>
<div class="ltx_listingline" id="alg3.l19">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">19:</span></span>
              
              
            Â Â Â Â Â Â Â Â Â <span class="ltx_text ltx_font_bold">if</span>Â <math alttext="\chi_{n}^{(\ell)}={\cal S}" class="ltx_Math" display="inline" id="alg3.l19.m1"><mrow><msubsup><mi>Ï‡</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mi class="ltx_font_mathcaligraphic">ğ’®</mi></mrow></math>Â <span class="ltx_text ltx_font_bold">then</span>
</div>
<div class="ltx_listingline" id="alg3.l20">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">20:</span></span>
              
              
            Â Â Â Â Â Â Â Â Â Â Â Â Â Â <math alttext="\omega_{n}^{(\ell)}\leftarrow 2\pi" class="ltx_Math" display="inline" id="alg3.l20.m1"><mrow><msubsup><mi>Ï‰</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">â†</mo><mrow><mn>2</mn><mo>â¢</mo><mi>Ï€</mi></mrow></mrow></math>
</div>
<div class="ltx_listingline" id="alg3.l21">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">21:</span></span>
              
              
            Â Â Â Â Â Â Â Â Â Â Â Â Â Â <math alttext="r_{n}^{(\ell-1)}\leftarrow 0" class="ltx_Math" display="inline" id="alg3.l21.m1"><mrow><msubsup><mi>r</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">â„“</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">â†</mo><mn>0</mn></mrow></math>
</div>
<div class="ltx_listingline" id="alg3.l22">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">22:</span></span>
              
              
            Â Â Â Â Â Â Â Â Â <span class="ltx_text ltx_font_bold">end</span>Â <span class="ltx_text ltx_font_bold">if</span>
</div>
<div class="ltx_listingline" id="alg3.l23">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">23:</span></span>
              
              
            Â Â Â Â Â Â Â Â Â <math alttext="r_{n}^{(\ell)}\leftarrow r_{n}^{(\ell-1)}+\left\lVert\mathbf{v}_{n}^{(\ell)}-%
\mathbf{v}_{n}^{(\ell-1)}\right\rVert_{2}" class="ltx_Math" display="inline" id="alg3.l23.m1"><mrow><msubsup><mi>r</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">â†</mo><mrow><msubsup><mi>r</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">â„“</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup><mo>+</mo><msub><mrow><mo fence="true" lspace="0em" rspace="0em">âˆ¥</mo><mrow><msubsup><mi>ğ¯</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>âˆ’</mo><msubsup><mi>ğ¯</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">â„“</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup></mrow><mo fence="true" lspace="0em" stretchy="true">âˆ¥</mo></mrow><mn>2</mn></msub></mrow></mrow></math>
</div>
<div class="ltx_listingline" id="alg3.l24">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">24:</span></span>
              
              
            Â Â Â Â Â Â Â Â Â <math alttext="\ell\leftarrow\ell+1" class="ltx_Math" display="inline" id="alg3.l24.m1"><mrow><mi mathvariant="normal">â„“</mi><mo stretchy="false">â†</mo><mrow><mi mathvariant="normal">â„“</mi><mo>+</mo><mn>1</mn></mrow></mrow></math>
</div>
<div class="ltx_listingline" id="alg3.l25">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">25:</span></span>
              
              
            Â Â Â Â Â <span class="ltx_text ltx_font_bold">end</span>Â <span class="ltx_text ltx_font_bold">if</span>
</div>
<div class="ltx_listingline" id="alg3.l26">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">26:</span></span>
<span class="ltx_text ltx_font_bold">end</span>Â <span class="ltx_text ltx_font_bold">while</span>
</div>
<div class="ltx_listingline" id="alg3.l27">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">27:</span></span>
<math alttext="\mathbf{C}\leftarrow\frac{\lambda^{2}}{(4\pi)^{2}\left|C\right|}\mathbf{C}" class="ltx_Math" display="inline" id="alg3.l27.m1"><mrow><mi>ğ‚</mi><mo stretchy="false">â†</mo><mrow><mfrac><msup><mi>Î»</mi><mn>2</mn></msup><mrow><msup><mrow><mo stretchy="false">(</mo><mrow><mn>4</mn><mo>â¢</mo><mi>Ï€</mi></mrow><mo stretchy="false">)</mo></mrow><mn>2</mn></msup><mo>â¢</mo><mrow><mo>|</mo><mi>C</mi><mo>|</mo></mrow></mrow></mfrac><mo>â¢</mo><mi>ğ‚</mi></mrow></mrow></math>
</div>
<div class="ltx_listingline" id="alg3.l28">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">28:</span></span>
<span class="ltx_text ltx_font_bold">return</span> <math alttext="\mathbf{C}" class="ltx_Math" display="inline" id="alg3.l28.m1"><mi>ğ‚</mi></math>
</div>
<div class="ltx_listingline" id="alg3.l29">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">29:</span></span>
</div>
<div class="ltx_listingline" id="alg3.l30">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">30:</span></span>
<span class="ltx_text ltx_font_bold">function</span>Â <span class="ltx_text ltx_font_smallcaps">Add_To_Radio_Map</span>(<math alttext="\mathbf{C},\mathbf{E},\widehat{\mathbf{k}},r,\omega,\mathbf{v}_{\text{mp}},%
\mathbf{v}" class="ltx_Math" display="inline" id="alg3.l30.m1"><mrow><mi>ğ‚</mi><mo>,</mo><mi>ğ„</mi><mo>,</mo><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mo>,</mo><mi>r</mi><mo>,</mo><mi>Ï‰</mi><mo>,</mo><msub><mi>ğ¯</mi><mtext>mp</mtext></msub><mo>,</mo><mi>ğ¯</mi></mrow></math>)

</div>
<div class="ltx_listingline" id="alg3.l31">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">31:</span></span>
              
              
            Â Â Â Â Â <math alttext="d\leftarrow r+\left\lVert\mathbf{v}_{\text{mp}}-\mathbf{v}\right\rVert_{2}" class="ltx_Math" display="inline" id="alg3.l31.m1"><mrow><mi>d</mi><mo stretchy="false">â†</mo><mrow><mi>r</mi><mo>+</mo><msub><mrow><mo fence="true" lspace="0em" rspace="0em">âˆ¥</mo><mrow><msub><mi>ğ¯</mi><mtext>mp</mtext></msub><mo>âˆ’</mo><mi>ğ¯</mi></mrow><mo fence="true" lspace="0em" stretchy="true">âˆ¥</mo></mrow><mn>2</mn></msub></mrow></mrow></math>
</div>
<div class="ltx_listingline" id="alg3.l32">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">32:</span></span>
              
              
            Â Â Â Â Â <math alttext="i\leftarrow\textsc{Get\_Map\_Index}(\mathbf{v}_{\text{mp}})" class="ltx_Math" display="inline" id="alg3.l32.m1"><mrow><mi>i</mi><mo stretchy="false">â†</mo><mrow><mtext class="ltx_font_smallcaps">Get_Map_Index</mtext><mo>â¢</mo><mrow><mo stretchy="false">(</mo><msub><mi>ğ¯</mi><mtext>mp</mtext></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></math>
</div>
<div class="ltx_listingline" id="alg3.l33">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">33:</span></span>
              
              
            Â Â Â Â Â <math alttext="\mathbf{C}_{i}\leftarrow\mathbf{C}_{i}+\frac{\omega d^{2}}{\left|\widehat{%
\mathbf{k}}^{\mathsf{T}}\widehat{\mathbf{n}}_{\text{mp}}\right|}\left\lVert%
\alpha_{n}\mathbf{E}\right\rVert_{2}^{2}" class="ltx_Math" display="inline" id="alg3.l33.m1"><mrow><msub><mi>ğ‚</mi><mi>i</mi></msub><mo stretchy="false">â†</mo><mrow><msub><mi>ğ‚</mi><mi>i</mi></msub><mo>+</mo><mrow><mfrac><mrow><mi>Ï‰</mi><mo>â¢</mo><msup><mi>d</mi><mn>2</mn></msup></mrow><mrow><mo>|</mo><mrow><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>ğ–³</mi></msup><mo>â¢</mo><msub><mover accent="true"><mi>ğ§</mi><mo>^</mo></mover><mtext>mp</mtext></msub></mrow><mo>|</mo></mrow></mfrac><mo lspace="0em">â¢</mo><msubsup><mrow><mo fence="true" rspace="0em">âˆ¥</mo><mrow><msub><mi>Î±</mi><mi>n</mi></msub><mo>â¢</mo><mi>ğ„</mi></mrow><mo fence="true" lspace="0em" stretchy="true">âˆ¥</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow></mrow></mrow></math>
</div>
<div class="ltx_listingline" id="alg3.l34">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">34:</span></span>
              
              
            Â Â Â Â Â <span class="ltx_text ltx_font_bold">return</span> <math alttext="\mathbf{C}" class="ltx_Math" display="inline" id="alg3.l34.m1"><mi>ğ‚</mi></math>
</div>
<div class="ltx_listingline" id="alg3.l35">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" style="font-size:80%;">35:</span></span>
<span class="ltx_text ltx_font_bold">end</span>Â <span class="ltx_text ltx_font_bold">function</span>
</div>
</div>
</figure>
<div class="ltx_para" id="SS2.p2">
<p class="ltx_p">AlgorithmÂ <a class="ltx_ref" href="#alg3" title="Algorithm 3 â€£ 4.2 SBR-based Radio Map Solver â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">3</span></a> outlines the SBR loop utilized by the SionnaÂ RT radio map solver. While the algorithm is presented for a single path <math alttext="n" class="ltx_Math" display="inline" id="SS2.p2.m1"><mi>n</mi></math>, the radio map solver processes all paths in parallel. The process begins by sampling the departure direction for each ray using a Fibonacci lattice, as detailed in SectionÂ <a class="ltx_ref" href="S3.html#SS1.SSS1" title="3.1.1 Sampling Initial Ray Directions â€£ 3.1 Generating Candidates by Shooting and Bouncing of Rays (SBR) â€£ 3 Path Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">3.1.1</span></a>. The electric field is initialized using the transmit pattern evaluated at the pathâ€™s departure direction <math alttext="\widehat{\mathbf{k}}^{(0)}_{n}" class="ltx_Math" display="inline" id="SS2.p2.m2"><msubsup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>n</mi><mrow><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></msubsup></math>. The ray tube length is initially set to zero, and its solid angle is set to <math alttext="4\pi/N_{S}" class="ltx_Math" display="inline" id="SS2.p2.m3"><mrow><mrow><mn>4</mn><mo>â¢</mo><mi>Ï€</mi></mrow><mo>/</mo><msub><mi>N</mi><mi>S</mi></msub></mrow></math>, since the <math alttext="N_{S}" class="ltx_Math" display="inline" id="SS2.p2.m4"><msub><mi>N</mi><mi>S</mi></msub></math> initial rays have departure directions on the unit sphere. The radio map is initialized to zero, and the path is marked as active. The <a href="#glo.acronym.SBR"><span class="ltx_glossaryref" href="#glo.acronym.SBR" title="shooting and bouncing of rays">SBR</span></a> loop continues to trace the paths through the scene until a user-defined maximum depth <math alttext="L\in\mathbb{N}" class="ltx_Math" display="inline" id="SS2.p2.m5"><mrow><mi>L</mi><mo>âˆˆ</mo><mi>â„•</mi></mrow></math> is reached or the ray is deactivated.
The loopâ€™s first step involves checking for intersections with the measurement plane. If an intersection is detected, the radio map is updated using the function <span class="ltx_text ltx_markedasmath ltx_font_typewriter">Add_To_Radio_Map</span>. The ray-plane intersection-checking function is not detailed in this document but is assumed to return the position of the intersection point <math alttext="\mathbf{v}_{\text{mp}}" class="ltx_Math" display="inline" id="SS2.p2.m7"><msub><mi>ğ¯</mi><mtext>mp</mtext></msub></math>.
The function <span class="ltx_text ltx_markedasmath ltx_font_typewriter">Add_To_Radio_Map</span> accumulates contributions to the radio map in the vector <math alttext="\mathbf{C}=\left[C_{1},\cdots,C_{N_{M}}\right]" class="ltx_Math" display="inline" id="SS2.p2.m9"><mrow><mi>ğ‚</mi><mo>=</mo><mrow><mo>[</mo><msub><mi>C</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant="normal">â‹¯</mi><mo>,</mo><msub><mi>C</mi><msub><mi>N</mi><mi>M</mi></msub></msub><mo>]</mo></mrow></mrow></math> at the intersected cell entry, as described inÂ (<a class="ltx_ref" href="#E43" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">43</span></a>).
Note that by iterating over path depth <math alttext="\ell=0,\dots,L" class="ltx_Math" display="inline" id="SS2.p2.m10"><mrow><mi mathvariant="normal">â„“</mi><mo>=</mo><mrow><mn>0</mn><mo>,</mo><mi mathvariant="normal">â€¦</mi><mo>,</mo><mi>L</mi></mrow></mrow></math> and adding contributions to the radio map at every iteration, the radio map solver accounts for paths of all depths, from <a href="#glo.acronym.LoS"><span class="ltx_glossaryref" href="#glo.acronym.LoS" title="line-of-sight">LoS</span></a> to the maximum depth.
The ray tube length is updated with the distance between the last intersection point and the measurement plane intersection point. Additionally, <math alttext="\widehat{\mathbf{n}}_{\text{mp}}" class="ltx_Math" display="inline" id="SS2.p2.m11"><msub><mover accent="true"><mi>ğ§</mi><mo>^</mo></mover><mtext>mp</mtext></msub></math> represents the normal vector to the measurement plane, and <math alttext="\left|\widehat{\mathbf{k}}^{\mathsf{T}}\widehat{\mathbf{n}}_{\text{mp}}\right|" class="ltx_Math" display="inline" id="SS2.p2.m12"><mrow><mo>|</mo><mrow><msup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>ğ–³</mi></msup><mo>â¢</mo><msub><mover accent="true"><mi>ğ§</mi><mo>^</mo></mover><mtext>mp</mtext></msub></mrow><mo>|</mo></mrow></math> is the cosine of the angle between the ray direction and the measurement plane normal. The weight <math alttext="\alpha_{n}" class="ltx_Math" display="inline" id="SS2.p2.m13"><msub><mi>Î±</mi><mi>n</mi></msub></math> accounts for the transmitter array, as explained in SectionÂ <a class="ltx_ref" href="#SS1.SSS2" title="4.1.2 Handling Multiple Transmit Antennas â€£ 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">4.1.2</span></a>.
Next, the algorithm checks for intersections with the scene. If no intersection is found, the ray is deactivated as it has exited the scene. Otherwise, an interaction type <math alttext="\chi_{n}^{(\ell)}" class="ltx_Math" display="inline" id="SS2.p2.m14"><msubsup><mi>Ï‡</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup></math> is sampled using the probability distribution from SectionÂ <a class="ltx_ref" href="S3.html#SS1.SSS2" title="3.1.2 Sampling Interaction Types â€£ 3.1 Generating Candidates by Shooting and Bouncing of Rays (SBR) â€£ 3 Path Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">3.1.2</span></a>, and the radio material is evaluated for the sampled interaction type. This results in the transfer matrix <math alttext="\mathbf{T}_{n}^{(\ell)}" class="ltx_Math" display="inline" id="SS2.p2.m15"><msubsup><mi>ğ“</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup></math> and the scattering direction <math alttext="\widehat{\mathbf{k}}_{n}^{(\ell)}" class="ltx_Math" display="inline" id="SS2.p2.m16"><msubsup><mover accent="true"><mi>ğ¤</mi><mo>^</mo></mover><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup></math>. Unlike AlgorithmÂ <a class="ltx_ref" href="S3.html#alg2" title="Algorithm 2 â€£ Ensuring Energy Conservation â€£ 3.3 Channel Coefficients, Delays, and Doppler Shifts Computation â€£ 3 Path Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">2</span></a>, the function <span class="ltx_text ltx_markedasmath ltx_font_typewriter">Sample_Evaluate_Interaction</span> samples the interaction type, scattered direction, and evaluates the radio material. The electric field is updated by applying the transfer matrix <math alttext="\mathbf{T}_{n}^{(\ell)}" class="ltx_Math" display="inline" id="SS2.p2.m18"><msubsup><mi>ğ“</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup></math> and dividing by the probability of the sampled interaction type. If the interaction type is diffuse, the ray tube length is reset to zero, and the solid angle weight is set to <math alttext="2\pi" class="ltx_Math" display="inline" id="SS2.p2.m19"><mrow><mn>2</mn><mo>â¢</mo><mi>Ï€</mi></mrow></math>, as diffuse reflection points act as new point sources, and as a single ray is emitted in the hemisphere containing the incident direction.
Note that in the case of diffuse reflection, the matrix <math alttext="\mathbf{T}_{n}^{(\ell)}" class="ltx_Math" display="inline" id="SS2.p2.m20"><msubsup><mi>ğ“</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">â„“</mi><mo stretchy="false">)</mo></mrow></msubsup></math> applies the scaling by <math alttext="\omega_{n}^{(\ell-1)}" class="ltx_Math" display="inline" id="SS2.p2.m21"><msubsup><mi>Ï‰</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">â„“</mi><mo>âˆ’</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></msubsup></math>.
The <a href="#glo.acronym.SBR"><span class="ltx_glossaryref" href="#glo.acronym.SBR" title="shooting and bouncing of rays">SBR</span></a> loop concludes by updating the ray tube length with the distance between the last and current intersection points.
Finally, the radio map computation is completed by scaling by <math alttext="\lambda^{2}/(4\pi)^{2}" class="ltx_Math" display="inline" id="SS2.p2.m22"><mrow><msup><mi>Î»</mi><mn>2</mn></msup><mo>/</mo><msup><mrow><mo stretchy="false">(</mo><mrow><mn>4</mn><mo>â¢</mo><mi>Ï€</mi></mrow><mo stretchy="false">)</mo></mrow><mn>2</mn></msup></mrow></math> according toÂ (<a class="ltx_ref" href="#E35" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">35</span></a>), and by the surface area of measurement cells, following the radio map definition inÂ (<a class="ltx_ref" href="#E33" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">33</span></a>).</p>
</div>
<figure class="ltx_figure" id="F25">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="F25.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_portrait" height="1063" id="F25.sf1.g1" src="figures/radio-map-solver-sbr-scene.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" style="font-size:90%;">(a)</span> </span><span class="ltx_text" style="font-size:90%;">Scene with the radio map.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="F25.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="538" id="F25.sf2.g1" src="x27.png" width="831"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" style="font-size:90%;">(b)</span> </span><span class="ltx_text" style="font-size:90%;">Computation time vs. number of samples <math alttext="N_{S}" class="ltx_Math" display="inline" id="F25.sf2.m2"><msub><mi>N</mi><mi>S</mi></msub></math>.</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" style="font-size:90%;">Figure 25</span>: </span><span class="ltx_text" style="font-size:90%;">Computation time for calculating radio maps using an NVIDIA RTX 4090 GPU for a single transmitter with a linear array of 1 to 1024 antennas.</span></figcaption>
</figure>
<div class="ltx_para" id="SS2.p3">
<p class="ltx_p">FigureÂ <a class="ltx_ref" href="#F25.sf2" title="In Figure 25 â€£ 4.2 SBR-based Radio Map Solver â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">25(b)</span></a> illustrates the computation time needed to generate a radio map for a single source as the number of samples <math alttext="N_{S}" class="ltx_Math" display="inline" id="SS2.p3.m1"><msub><mi>N</mi><mi>S</mi></msub></math> and the number of transmit antennas <math alttext="N_{A}^{\text{tx}}" class="ltx_Math" display="inline" id="SS2.p3.m2"><msubsup><mi>N</mi><mi>A</mi><mtext>tx</mtext></msubsup></math> are varied. The setup, depicted in FigureÂ <a class="ltx_ref" href="#F25.sf1" title="In Figure 25 â€£ 4.2 SBR-based Radio Map Solver â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">25(a)</span></a>, employs the â€œsimple street canyonâ€ scene built into SionnaÂ RT. The red ball indicates the source, positioned 20 meters above the ground. The radio map in FigureÂ <a class="ltx_ref" href="#F25.sf1" title="In Figure 25 â€£ 4.2 SBR-based Radio Map Solver â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">25(a)</span></a> is calculated using <math alttext="10^{8}" class="ltx_Math" display="inline" id="SS2.p3.m3"><msup><mn>10</mn><mn>8</mn></msup></math> samples and a linear array of 512 transmit antennas. Notably, the radio map solver can compute radio maps with <math alttext="10^{9}" class="ltx_Math" display="inline" id="SS2.p3.m4"><msup><mn>10</mn><mn>9</mn></msup></math> samples on a single NVIDIA RTX 4090 GPU.
The computation time increases with both the number of samples and antennas, exceeding one second only for the most demanding computations. It is important to note that while the computation time increases with the number of antennas due to the precomputation of the array weighting factor <math alttext="\alpha" class="ltx_Math" display="inline" id="SS2.p3.m5"><mi>Î±</mi></math>, it does not increase the memory footprint of the radio map solver (see SectionÂ <a class="ltx_ref" href="#SS1.SSS2" title="4.1.2 Handling Multiple Transmit Antennas â€£ 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">4.1.2</span></a>).</p>
</div>
<section class="ltx_paragraph" id="SS2.SSS0.Px1">
<h4 class="ltx_title ltx_title_paragraph">Handling of Dual-Polarized Transmit Antennas</h4>
<div class="ltx_para" id="SS2.SSS0.Px1.p1">
<p class="ltx_p">The radio map solver supports dual-polarized transmit antennas by considering two independent electric field vectors for each path. These are processed as if they were separate antenna elements (see SectionÂ <a class="ltx_ref" href="#SS1.SSS2" title="4.1.2 Handling Multiple Transmit Antennas â€£ 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">4.1.2</span></a>).</p>
</div>
</section>
<section class="ltx_paragraph" id="SS2.SSS0.Px2">
<h4 class="ltx_title ltx_title_paragraph">Scaling with the Number of Measurement Cells</h4>
<div class="ltx_para" id="SS2.SSS0.Px2.p1">
<p class="ltx_p">A key benefit of the radio map solver is that the compute required to generate the radio map remains constant regardless of the number of measurement cells. However, increasing the number of measurement cells will naturally require more memory for storage. Additionally, when the size of the measurement cells is reduced, it may be necessary to increase the number of samples <math alttext="N_{S}" class="ltx_Math" display="inline" id="SS2.SSS0.Px2.p1.m1"><msub><mi>N</mi><mi>S</mi></msub></math> to maintain the accuracy of the estimatorÂ (<a class="ltx_ref" href="#E43" title="In 4.1 Definition of a Radio Map â€£ 4 Radio Map Solver â€£ Sionna RT: Technical Report"><span class="ltx_text ltx_ref_tag">43</span></a>), as fewer paths will intersect with each measurement cell, resulting in noisier radio maps.</p>
</div>
</section>
<section class="ltx_paragraph" id="SS2.SSS0.Px3">
<h4 class="ltx_title ltx_title_paragraph">Early Termination with Russian Roulette and Gain Thresholding</h4>
<div class="ltx_para" id="SS2.SSS0.Px3.p1">
<p class="ltx_p">The radio map solver allows for early deactivation of paths using two techniques: Russian roulette and gain thresholding.
With gain thresholding, a path with ray tube length <math alttext="r" class="ltx_Math" display="inline" id="SS2.SSS0.Px3.p1.m1"><mi>r</mi></math> is deactivated when the squared amplitude of the electric field <math alttext="\left\lVert\mathbf{E}\right\rVert_{2}^{2}" class="ltx_Math" display="inline" id="SS2.SSS0.Px3.p1.m2"><msubsup><mrow><mo fence="true" rspace="0em">âˆ¥</mo><mi>ğ„</mi><mo fence="true" lspace="0em" stretchy="true">âˆ¥</mo></mrow><mn>2</mn><mn>2</mn></msubsup></math> falls below a user-defined threshold.
With Russian roulette, at each iteration, a path continues with a probability given by</p>
<table class="ltx_equation ltx_eqn_table" id="E48">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p_{\text{rr}}=\min\left(r^{2}\left\lVert\mathbf{E}\right\rVert_{2}^{2},p_{%
\text{rr,max}}\right)" class="ltx_Math" display="block" id="E48.m1"><mrow><msub><mi>p</mi><mtext>rr</mtext></msub><mo>=</mo><mrow><mi>min</mi><mo>â¡</mo><mrow><mo>(</mo><mrow><msup><mi>r</mi><mn>2</mn></msup><mo lspace="0em">â¢</mo><msubsup><mrow><mo fence="true" rspace="0em">âˆ¥</mo><mi>ğ„</mi><mo fence="true" lspace="0em" rspace="0em" stretchy="true">âˆ¥</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><mo>,</mo><msub><mi>p</mi><mtext>rr,max</mtext></msub><mo>)</mo></mrow></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(48)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where <math alttext="p_{\text{rr,max}}" class="ltx_Math" display="inline" id="SS2.SSS0.Px3.p1.m3"><msub><mi>p</mi><mtext>rr,max</mtext></msub></math> is the maximum probability, set by the user, for keeping the path active.
Both features can be enabled simultaneously and are applied only after a user-defined depth is reached.</p>
</div>
</section>
<section class="ltx_paragraph" id="SS2.SSS0.Px4">
<h4 class="ltx_title ltx_title_paragraph">Extension to other Types of Radio Maps</h4>
<div class="ltx_para" id="SS2.SSS0.Px4.p1">
<p class="ltx_p">The SionnaÂ RT solver currently supports the calculation of channel gain maps, which are radio maps that provide an estimate of the channel gain for each cell. It is possible to extend the solver to calculate other types of radio maps, such as root-mean-square delay spread maps and angular spread mapsÂ <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bib18" title="">18</a>]</cite>.</p>
</div>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
</section>
</section>
</div>
<footer class="ltx_page_footer">
<div class="ltx_align_center">
</div>
<div class="ltx_page_logo">Generated  on Tue Jun  3 13:07:48 2025 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
